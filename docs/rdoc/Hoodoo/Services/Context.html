<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Hoodoo::Services::Context - Hoodoo</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link">Object
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-new">::new</a>
    <li ><a href="#method-i-endpoint">#endpoint</a>
    <li ><a href="#method-i-resource">#resource</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Hoodoo::Services::Context">
  <h1 id="class-Hoodoo::Services::Context" class="class">
    class Hoodoo::Services::Context
  </h1>

  <section class="description">
    
<p>A collection of objects which describe the context in which a service is being called. The service reads session and request information and returns results of its processing via the associated response object.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-owning_interaction" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">owning_interaction</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>The <a href="Middleware/Interaction.html"><code>Hoodoo::Services::Middleware::Interaction</code></a> instance for which this context exists (the ‘owning’ instance). Generally speaking this is only needed internally as part of the inter-resource call mechanism.</p>
        </div>
      </div>
      <div id="attribute-i-request" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">request</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>The <a href="Request.html"><code>Hoodoo::Services::Request</code></a> instance giving details about the inbound request. Relevant information will depend upon the endpoint service implementation action being addressed.</p>
        </div>
      </div>
      <div id="attribute-i-response" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">response</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>The <a href="Response.html"><code>Hoodoo::Services::Response</code></a> instance that a service implementation updates with results of its processing.</p>
        </div>
      </div>
      <div id="attribute-i-session" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">session</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>The <a href="Session.html"><code>Hoodoo::Services::Session</code></a> instance describing the authorised call context. If a resource implementation is handling a public action this may be <code>nil</code>, else it will be a valid instance.</p>
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">( session, request, response, owning_interaction )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Create a new instance. There is almost certainly never any need to call this unless you’re the <a href="Middleware/Interaction.html"><code>Hoodoo::Services::Middleware::Interaction</code></a> constructor! If you want to build a context for (say) test purposes, it’s probably best to construct an interaction instance and use the context instance this provides.</p>
<dl class="rdoc-list note-list"><dt><code>session</code>
<dd>
<p>See <a href="Context.html#attribute-i-session"><code>session</code></a>.</p>
</dd><dt><code>request</code>
<dd>
<p>See <a href="Context.html#attribute-i-request"><code>request</code></a>.</p>
</dd><dt><code>response</code>
<dd>
<p>See <a href="Context.html#attribute-i-response"><code>response</code></a>.</p>
</dd><dt><code>owning_interaction</code>
<dd>
<p>See interaction.</p>
</dd></dl>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/context.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>( <span class="ruby-identifier">session</span>, <span class="ruby-identifier">request</span>, <span class="ruby-identifier">response</span>, <span class="ruby-identifier">owning_interaction</span> )
  <span class="ruby-ivar">@session</span>            = <span class="ruby-identifier">session</span>
  <span class="ruby-ivar">@request</span>            = <span class="ruby-identifier">request</span>
  <span class="ruby-ivar">@response</span>           = <span class="ruby-identifier">response</span>
  <span class="ruby-ivar">@owning_interaction</span> = <span class="ruby-identifier">owning_interaction</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-endpoint" class="method-detail method-alias">
        <div class="method-heading">
          <span class="method-name">endpoint</span><span
            class="method-args">( resource, version = 1, options = {} )</span>
        </div>

        <div class="method-description">
          <p>Alias of <a href="Context.html#method-i-resource"><code>resource</code></a>, as syntax sugar for those who prefer to think of the return value as an endpoint that is used to contact a resource, rather than a remote abstraction of the resource as an entity.</p>

        </div>


        <div class="aliases">
          Alias for: <a href="Context.html#method-i-resource">resource</a>
        </div>
      </div>

      <div id="method-i-resource" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">resource</span><span
            class="method-args">( resource, version = 1, options = {} )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p><a href="Request.html"><code>Request</code></a> (and lazy-initialize) a new resource endpoint instance for talking to a resource’s interface. See <a href="../Client/Endpoint.html"><code>Hoodoo::Client::Endpoint</code></a>.</p>

<p>You can request an endpoint for any resource name, whether or not an implementation actually exists for it. Until you try and talk to the interface through the endpoint instance, you won’t know if it is there. All endpoint methods return instances of classes that mix in <a href="../Client/AugmentedBase.html"><code>Hoodoo::Client::AugmentedBase</code></a>; these mixin methods provide error handling options to detect a “not found” error (equivanent to HTTP status code 404) returned when a resource implementation turns out to not actually be present.</p>

<p>The idiomatic call sequence is something like the following, where you get hold of an endpoint, make a call and handle the response:</p>

<pre class="ruby"><span class="ruby-identifier">clock</span> = <span class="ruby-identifier">context</span>.<span class="ruby-identifier">resource</span>( <span class="ruby-value">:Clock</span>, <span class="ruby-value">2</span> ) <span class="ruby-comment"># v2 of &#39;Clock&#39; resource</span>
<span class="ruby-identifier">time</span>  = <span class="ruby-identifier">clock</span>.<span class="ruby-identifier">show</span>( <span class="ruby-string">&#39;now&#39;</span> )

<span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">adds_errors_to?</span>( <span class="ruby-identifier">context</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">errors</span> )
</pre>

<p>…or alternatively:</p>

<pre class="ruby"><span class="ruby-identifier">clock</span> = <span class="ruby-identifier">context</span>.<span class="ruby-identifier">resource</span>( <span class="ruby-value">:Clock</span>, <span class="ruby-value">2</span> ) <span class="ruby-comment"># v2 of &#39;Clock&#39; resource</span>
<span class="ruby-identifier">time</span>  = <span class="ruby-identifier">clock</span>.<span class="ruby-identifier">show</span>( <span class="ruby-string">&#39;now&#39;</span> )

<span class="ruby-identifier">context</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">add_errors</span>( <span class="ruby-identifier">time</span>.<span class="ruby-identifier">platform_errors</span> )
<span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">context</span>.<span class="ruby-identifier">response</span>.<span class="ruby-identifier">halt_processing?</span>
</pre>

<p>The return value of calls made to the endpoint is an Array or Hash that mixes in <a href="../Client/AugmentedBase.html"><code>Hoodoo::Client::AugmentedBase</code></a>; see this class’s documentation for details of the two alternative error handling approaches shown above.</p>
<dl class="rdoc-list note-list"><dt><code>resource</code>
<dd>
<p>Resource name for the endpoint, e.g. <code>:Purchase</code>. String or symbol.</p>
</dd><dt><code>version</code>
<dd>
<p>Optional required implemented version for the endpoint, as an Integer - defaults to 1.</p>
</dd><dt><code>options</code>
<dd>
<p>Optional options Hash (see below).</p>
</dd></dl>

<p>The options Hash key/values are as follows:</p>
<dl class="rdoc-list note-list"><dt><code>locale</code>
<dd>
<p>Locale string for request/response, e.g. “en-gb”. Optional. If omitted, defaults to the locale set in this <a href="../Client.html"><code>Client</code></a> instance’s constructor.</p>
</dd><dt>Others
<dd>
<p>See <a href="../Client/Headers.html"><code>Hoodoo::Client::Headers</code></a>‘ <code>HEADER_TO_PROPERTY</code>. For any options in that map which describe themselves as being automatically transferred from one endpoint to another, you can prevent this by explicitly pasisng a <code>nil</code> value for the option; otherwise, <em>OMIT</em> the option for normal behaviour. Non-auto-transfer properties can be specified as <code>nil</code> or omitted with no change in behaviour.</p>
</dd></dl>

          <div class="method-source-code" id="resource-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/context.rb, line 117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">resource</span>( <span class="ruby-identifier">resource</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">options</span> = {} )
  <span class="ruby-identifier">middleware</span> = <span class="ruby-ivar">@owning_interaction</span>.<span class="ruby-identifier">owning_middleware_instance</span>
  <span class="ruby-identifier">endpoint</span>   = <span class="ruby-identifier">middleware</span>.<span class="ruby-identifier">inter_resource_endpoint_for</span>(
    <span class="ruby-identifier">resource</span>,
    <span class="ruby-identifier">version</span>,
    <span class="ruby-ivar">@owning_interaction</span>
  )

  <span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">locale</span> = <span class="ruby-identifier">options</span>[ <span class="ruby-value">:locale</span> ] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[ <span class="ruby-value">:locale</span> ].<span class="ruby-identifier">nil?</span>

  <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-constant">Headers</span><span class="ruby-operator">::</span><span class="ruby-constant">HEADER_TO_PROPERTY</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">rack_header</span>, <span class="ruby-identifier">description</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">property</span>        = <span class="ruby-identifier">description</span>[ <span class="ruby-value">:property</span>        ]
    <span class="ruby-identifier">property_writer</span> = <span class="ruby-identifier">description</span>[ <span class="ruby-value">:property_writer</span> ]
    <span class="ruby-identifier">auto_transfer</span>   = <span class="ruby-identifier">description</span>[ <span class="ruby-value">:auto_transfer</span>   ]

    <span class="ruby-comment"># For automatically transferred options there&#39;s no way to stop the</span>
    <span class="ruby-comment"># auto transfer unless explicitly stating &#39;nil&#39; to overwrite any</span>
    <span class="ruby-comment"># existing value, so here, only write the value into the endpoint if</span>
    <span class="ruby-comment"># the property specifically exists in the inbound options hash.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># For other properties, &#39;nil&#39; has no meaning and there&#39;s no need to</span>
    <span class="ruby-comment"># override anything, so use &quot;unless nil?&quot; in that case.</span>

    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">options</span>[ <span class="ruby-identifier">property</span> ]

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">auto_transfer</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">send</span>( <span class="ruby-identifier">property_writer</span>, <span class="ruby-identifier">value</span> ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-identifier">property</span> )
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">send</span>( <span class="ruby-identifier">property_writer</span>, <span class="ruby-identifier">value</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">endpoint</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>

        <div class="aliases">
          Also aliased as: <a href="Context.html#method-i-endpoint">endpoint</a>
        </div>

      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

