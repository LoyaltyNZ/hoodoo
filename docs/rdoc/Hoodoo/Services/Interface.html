<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Hoodoo::Services::Interface - Hoodoo</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link">Object
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-interface">::interface</a>
    <li ><a href="#method-c-to_list">::to_list</a>
    <li ><a href="#method-i-actions">#actions</a>
    <li ><a href="#method-i-additional_permissions_for">#additional_permissions_for</a>
    <li ><a href="#method-i-embeds">#embeds</a>
    <li ><a href="#method-i-endpoint">#endpoint</a>
    <li ><a href="#method-i-errors_for">#errors_for</a>
    <li ><a href="#method-i-public_actions">#public_actions</a>
    <li ><a href="#method-i-secure_log_for">#secure_log_for</a>
    <li ><a href="#method-i-to_create">#to_create</a>
    <li ><a href="#method-i-to_list">#to_list</a>
    <li ><a href="#method-i-to_update">#to_update</a>
    <li ><a href="#method-i-update_same_as_create">#update_same_as_create</a>
    <li ><a href="#method-i-version">#version</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Hoodoo::Services::Interface">
  <h1 id="class-Hoodoo::Services::Interface" class="class">
    class Hoodoo::Services::Interface
  </h1>

  <section class="description">
    
<p><a href="Service.html"><code>Service</code></a> implementation authors subclass this to describe the interface that they implement for a particular Resource, as documented in the Loyalty Platform API.</p>

<p>See class method <a href="Interface.html#method-c-interface"><code>::interface</code></a> for details.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-c-actions" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">actions</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Supported action methods as a Set of symbols with one or more of <code>:list</code>, <code>:show</code>, <code>:create</code>, <code>:update</code> or <code>:delete</code>. The presence of a Symbol indicates a supported action. If empty, no actions are supported. The default is for all actions to be present in the Set.</p>
        </div>
      </div>
      <div id="attribute-c-additional_permissions" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">additional_permissions</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>A Hash, keyed by String equivalents of the Symbols in Hoodoo::Services::Middleware::ALLOWED_ACTIONS, where the values are <a href="Permissions.html"><code>Hoodoo::Services::Permissions</code></a> instances describing extended permissions for the related action. See ::additional_permissions_for.</p>
        </div>
      </div>
      <div id="attribute-c-embeds" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">embeds</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Array of strings listing allowed embeddable things. Each string matches the split up comma-separated value for query string <code>_embed</code> or <code>_reference</code> keys. For example:</p>

<pre>...&amp;_embed=foo,bar</pre>

<p>…would be valid provided there was an embedding declaration such as:</p>

<pre class="ruby"><span class="ruby-identifier">embeds</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:bar</span>
</pre>

<p>…which would in turn lead this accessor to return:</p>

<pre class="ruby">[ <span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-string">&#39;bar&#39;</span> ]
</pre>
        </div>
      </div>
      <div id="attribute-c-endpoint" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">endpoint</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Endpoint path as declared by service, without preceding “/”, possibly as a symbol - e.g. <code>:products</code> for “/<a href="...">products</a>” as an implied endpoint.</p>
        </div>
      </div>
      <div id="attribute-c-errors_for" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">errors_for</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>A <a href="../ErrorDescriptions.html"><code>Hoodoo::ErrorDescriptions</code></a> instance describing all errors that the interface might return, including the default set of platform and generic errors. If nil, there are no additional error codes beyond the default set.</p>
        </div>
      </div>
      <div id="attribute-c-implementation" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">implementation</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p><a href="Implementation.html"><code>Implementation</code></a> class for the service. An <a href="Implementation.html"><code>Hoodoo::Services::Implementation</code></a> subclass - the class, not an instance of it.</p>
        </div>
      </div>
      <div id="attribute-c-public_actions" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">public_actions</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Public action methods as a Set of symbols with one or more of <code>:list</code>, <code>:show</code>, <code>:create</code>, <code>:update</code> or <code>:delete</code>. The presence of a Symbol indicates an action open to the public and not subject to session security. If empty, all actions are protected by session security. The default is an empty Set.</p>
        </div>
      </div>
      <div id="attribute-c-resource" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">resource</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Name of the resource the interface addresses as a symbol, e.g. <code>:Product</code>.</p>
        </div>
      </div>
      <div id="attribute-c-secure_log_for" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">secure_log_for</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Secure log actions set by <a href="Interface.html#method-i-secure_log_for"><code>secure_log_for</code></a> - see that call for details. The default is an empty Hash.</p>
        </div>
      </div>
      <div id="attribute-c-to_create" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">to_create</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>A <a href="../Presenters/Object.html"><code>Hoodoo::Presenters::Object</code></a> instance describing the schema for client JSON coming in for calls that create instances of the resource that the service’s interface is addressing. If <code>nil</code>, arbitrary data is acceptable (the implementation becomes entirely responsible for data validation).</p>
        </div>
      </div>
      <div id="attribute-c-to_update" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">to_update</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>A <a href="../Presenters/Object.html"><code>Hoodoo::Presenters::Object</code></a> instance describing the schema for client JSON coming in for calls that modify instances of the resource that the service’s interface is addressing. If <code>nil</code>, arbitrary data is acceptable (the implementation becomes entirely responsible for data validation).</p>
        </div>
      </div>
      <div id="attribute-c-version" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">version</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Major version of interface as an integer. All service endpoint routes have “v{version}/” as a prefix, e.g. “/<a href="...">v1/products</a>”.</p>
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-to_list" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>A <a href="Interface/ToList.html"><code>Hoodoo::Services::Interface::ToList</code></a> instance describing the list parameters for the interface as a Set of Strings. See also <a href="Interface/ToListDSL.html"><code>Hoodoo::Services::Interface::ToListDSL</code></a>.</p>

          <div class="method-source-code" id="to_list-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 879</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_list</span>
  <span class="ruby-ivar">@to_list</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">ToList</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@to_list</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="protected-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Class Methods</h3>
       </header>

      <div id="method-c-interface" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">interface</span><span
            class="method-args">( resource, &amp;block )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Define the subclass Service’s interface. A DSL is used with methods documented in the Hoodoo::Services::InterfaceDSL class.</p>

<p>The absolute bare minimum interface description just states that a particular implementation class is used when requests are made to a particular URL endpoint, which is implementing an interface for a particular given resource. For a hypothetical Magic resource interface:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MagicImplementation</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Implementation</span>
  <span class="ruby-comment"># ...implementation code goes here...</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MagicInterface</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Interface</span>
  <span class="ruby-identifier">interface</span> <span class="ruby-value">:Magic</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">endpoint</span> <span class="ruby-value">:paul_daniels</span>, <span class="ruby-constant">MagicImplementation</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This would cause all calls to URLs at ‘/<a href="...">paul_daniels</a>’ to be routed to an instance of the MagicImplementation class.</p>

<p>Addtional DSL facilities allow the interface to say what HTTP methods it supports (in terms of the action methods that it supports inside its implementation class), describe any extra sort, search or filter data it allows beyond the common fields and describe the expected JSON fields for creation and/or modification actions. By specifing these, the service middleware code is able to do extra validation and sanitisation of client requests, but they’re entirely optional if the implementation class wants to take over all of that itself.</p>
<dl class="rdoc-list note-list"><dt><code>resource</code>
<dd>
<p>Name of the resource that the interface is for, as a String or Symbol (e.g. <code>:Purchase</code>).</p>
</dd><dt>&amp;block
<dd>
<p>Block that calls the Hoodoo::Services::InterfaceDSL methods; <a href="Interface.html#method-i-endpoint"><code>endpoint</code></a> is the only mandatory call.</p>
</dd></dl>

          <div class="method-source-code" id="interface-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 779</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">interface</span>( <span class="ruby-identifier">resource</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@to_list</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@to_list</span> = <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">ToList</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Hoodoo::Services::Interface subclass unexpectedly ran ::interface more than once&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">resource</span> = <span class="ruby-identifier">resource</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-identifier">interface</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">interface</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">version</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">embeds</span> <span class="ruby-comment"># Nothing</span>
    <span class="ruby-identifier">actions</span> <span class="ruby-operator">*</span><span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleware</span><span class="ruby-operator">::</span><span class="ruby-constant">ALLOWED_ACTIONS</span>
    <span class="ruby-identifier">public_actions</span> <span class="ruby-comment"># None</span>
    <span class="ruby-identifier">secure_log_for</span> <span class="ruby-comment"># None</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">interface</span>.<span class="ruby-identifier">instance_eval</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )

  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">endpoint</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Hoodoo::Services::Interface subclasses must always call the &#39;endpoint&#39; DSL method in their interface descriptions&quot;</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-actions" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">actions</span><span
            class="method-args">( *supported_actions )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>List the actions that the service implementation supports. If you don’t call this, the middleware assumes that all actions are available; else it only calls for supported actions. If you declared an empty array, your implementation would never be called.</p>
<dl class="rdoc-list note-list"><dt>*supported_actions
<dd>
<p>One or more from <code>:list</code>, <code>:show</code>, <code>:create</code>, <code>:update</code> and <code>:delete</code>. Always use symbols, not strings. An exception is raised if unrecognised actions are given.</p>
</dd></dl>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">actions</span> <span class="ruby-value">:list</span>, <span class="ruby-value">:show</span>
</pre>

          <div class="method-source-code" id="actions-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 373</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">actions</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">supported_actions</span> )
  <span class="ruby-identifier">supported_actions</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">to_sym</span> }
  <span class="ruby-identifier">invalid</span> = <span class="ruby-identifier">supported_actions</span> <span class="ruby-operator">-</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleware</span><span class="ruby-operator">::</span><span class="ruby-constant">ALLOWED_ACTIONS</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">invalid</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::Services::Interface#actions does not recognise one or more actions: &#39;#{ invalid.join( &#39;, &#39; ) }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:actions=</span>, <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">supported_actions</span> ) )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-additional_permissions_for" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">additional_permissions_for</span><span
            class="method-args">( action ) { |p| ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Declare additional permissions that you require for a given action.</p>

<p>If the implementation of a resource endpoint involves making calls out to other resources, then you need to consider how authorisation is granted to those other resources.</p>

<p>The <a href="Session.html"><code>Hoodoo::Services::Session</code></a> instance for the inbound external caller carries a Hoodoo::Services::Permission instance describing the actions that the caller is permitted to do. The middleware enforces these permissions, so that a resource implementation won’t be called at all unless the caller has permission to do so.</p>

<p>These permissions continue to apply during inter-resource calls. The wider session context is always applied. So, if one resource calls another resource, either:</p>
<ul><li>
<p>The inbound API caller’s session must have all necessary permissions for both the resource it is actually directly calling, and for any actions in any resources that the called resource in turn calls (and so-on, for any chain of resources).</p>
</li></ul>

<p>…or…</p>
<ul><li>
<p>The resource uses this <code>additional_permissions_for</code> method to declare up-front that it will require the described permissions when a particular action is performed on it. When an inter-resource call is made, a temporary internal-only session is constructed that merges the permissions of the inbound caller with the additional permissions requested by the resource. The downstream called resource needs no special case code at all - it just sees a valid session with valid permissions and does what the upstream resource asked of it.</p>
</li></ul>

<p>For example, suppose a resource Clock returns both a time and a date, by calling out to the Time and Date resources. One option is that the inbound caller must have <code>show</code> action permissions for all of Clock, Time and Date; if any of those are missing, then an attempt to call <code>show</code> on the Clock resource would result in a 403 response.</p>

<p>The other option is for Clock’s interface to declare its requirements:</p>

<pre class="ruby"><span class="ruby-identifier">additional_permissions_for</span>( <span class="ruby-value">:show</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">p</span> <span class="ruby-operator">|</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">set_resource</span>( <span class="ruby-value">:Time</span>, <span class="ruby-value">:show</span>, <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Permissions</span><span class="ruby-operator">::</span><span class="ruby-constant">ALLOW</span> )
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">set_resource</span>( <span class="ruby-value">:Date</span>, <span class="ruby-value">:show</span>, <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Permissions</span><span class="ruby-operator">::</span><span class="ruby-constant">ALLOW</span> )
<span class="ruby-keyword">end</span>
</pre>

<p>Suppose you could create Clock instances for some reason, but there was an audit trail for this; Clock must create an Audit entry itself, but you don’t want to expose this ability to external callers through their session permissions; so, just declare your additional permissions for that specific inter-service case:</p>

<pre class="ruby"><span class="ruby-identifier">additional_permissions_for</span>( <span class="ruby-value">:create</span> ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">p</span> <span class="ruby-operator">|</span>
  <span class="ruby-identifier">p</span>.<span class="ruby-identifier">set_resource</span>( <span class="ruby-value">:Audit</span>, <span class="ruby-value">:create</span>, <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Permissions</span><span class="ruby-operator">::</span><span class="ruby-constant">ALLOW</span> )
<span class="ruby-keyword">end</span>
</pre>

<p>The call says which action in <em>the</em> <em>declaring</em> _interface’s_ <em>resource</em> is a target. The block takes a single parameter; this is a default initialisation <a href="Permissions.html"><code>Hoodoo::Services::Permissions</code></a> instance. Use that object’s methods to set up whatever permissions you need in other resources, to successfully process the action in question. You only need to describe the resources you immediately call, not the whole chain - if “this” resource calls another, then it’s up to the other resource to in turn describe additional permissions should it make its own set of downstream calls to further resource endpoints.</p>

<p>Setting default permissions or especially the default permission fallback inside the block is possible but <strong>VERY</strong> <strong>STRONGLY</strong> <strong>DISCOURAGED</strong>. Instead, precisely describe the downstream resources, actions and permissions that are required.</p>

<p>Note an important restriction - public actions (see <a href="Interface.html#attribute-c-public_actions"><code>::public_actions</code></a>) cannot be augmented in this way. A public action in one resource can only ever call public actions in other resources. This is because no session is needed <em>at</em> <em>all</em> to call a public action; calling into a protected action in another resource from this context would require invention of a full caller context which would be entirely invented and could represent an accidental (and significant) security hole.</p>

<p>If you call this method for the same action more than once, the last call will be the one that takes effect - each call overwrites the results of any previous call made for the same action.</p>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>action</code>
<dd>
<p>The action in this interface which will require the additional permissions to be described. Pass a Symbol or equivalent String from the list in Hoodoo::Services::Middleware::ALLOWED_ACTIONS.</p>
</dd><dt>&amp;block
<dd>
<p>Block which is passed a new, default state <a href="Permissions.html"><code>Hoodoo::Services::Permissions</code></a> instance; make method calls on this instance to describe the required permissions.</p>
</dd></dl>

          <div class="method-source-code" id="additional_permissions_for-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 726</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">additional_permissions_for</span>( <span class="ruby-identifier">action</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
  <span class="ruby-identifier">action</span> = <span class="ruby-identifier">action</span>.<span class="ruby-identifier">to_s</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;Hoodoo::Services::Interface#additional_permissions_for must be passed a block&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">p</span> = <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Permissions</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">yield</span>( <span class="ruby-identifier">p</span> )

  <span class="ruby-identifier">additional_permissions</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">additional_permissions</span>() <span class="ruby-operator">||</span> {}
  <span class="ruby-identifier">additional_permissions</span>[ <span class="ruby-identifier">action</span> ] = <span class="ruby-identifier">p</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:additional_permissions=</span>, <span class="ruby-identifier">additional_permissions</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-embeds" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">embeds</span><span
            class="method-args">( *embeds )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>An array of supported embed keys (as per documentation, so singular or plural as per resource interface descriptions in the Loyalty Platform API). Things which can be embedded can also be referenced, via the <code>_embed</code> and <code>_reference</code> query string keys.</p>

<p>The middleware uses the list to reject requests from clients which ask for embedded or referenced entities that were not listed by the interface. If you don’t call here, or call here with an empty array, no embedding or referencing will be allowed for calls to the service implementation.</p>
<dl class="rdoc-list note-list"><dt><code>embed</code>
<dd>
<p>Array of permitted embeddable entity names, as symbols or strings. The order of array entries is arbitrary.</p>
</dd></dl>

<p>Example: An interface permits lists that request embedding or referencing of “vouchers”, “balances” and “member”:</p>

<pre class="ruby"><span class="ruby-identifier">embeds</span> <span class="ruby-value">:vouchers</span>, <span class="ruby-value">:balances</span>, <span class="ruby-value">:member</span>
</pre>

<p>As a result, <a href="Interface.html#method-i-embeds"><code>embeds</code></a> would return:</p>

<pre class="ruby">[ <span class="ruby-string">&#39;vouchers&#39;</span>, <span class="ruby-string">&#39;balances&#39;</span>, <span class="ruby-string">&#39;member&#39;</span> ]
</pre>

          <div class="method-source-code" id="embeds-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 496</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">embeds</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">embeds</span> )
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:embeds=</span>, <span class="ruby-identifier">embeds</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">to_s</span> } )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-endpoint" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">endpoint</span><span
            class="method-args">( uri_path_fragment, implementation_class )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Mandatory part of the interface DSL. Declare the interface’s URL endpoint and the <a href="Implementation.html"><code>Hoodoo::Services::Implementation</code></a> subclass to be invoked when client requests are sent to a URL matching the endpoint.</p>

<p>No two interfaces can use the same endpoint within a service application, unless the describe a different interface version - see <a href="Interface.html#method-i-version"><code>version</code></a>.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">endpoint</span> <span class="ruby-value">:estimations</span>, <span class="ruby-constant">PurchaseImplementation</span>
</pre>
<dl class="rdoc-list note-list"><dt><code>uri_path_fragment</code>
<dd>
<p>Path fragment to match at the start of a URL path, as a symbol or string, excluding leading “/”. The URL path matches the fragment if the path starts with a “/”, then matches the fragment exactly, then is followed by either “.”, another “/”, or the end of the path string. For example, a fragment of <code>:products</code> matches all paths out of <code>/products</code>, <code>/products.json</code> or <code>/products/22</code>, but does not match <code>/products_and_things</code>.</p>
</dd><dt><code>implementation_class</code>
<dd>
<p>The <a href="Implementation.html"><code>Hoodoo::Services::Implementation</code></a> subclass (the class itself, not an instance of it) that should be used when a request matching the path fragment is received.</p>
</dd></dl>

          <div class="method-source-code" id="endpoint-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 333</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">endpoint</span>( <span class="ruby-identifier">uri_path_fragment</span>, <span class="ruby-identifier">implementation_class</span> )

  <span class="ruby-comment"># http://www.ruby-doc.org/core-2.2.3/Module.html#method-i-3C</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">implementation_class</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Implementation</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::Services::Interface#endpoint must provide Hoodoo::Services::Implementation subclasses, but &#39;#{ implementation_class }&#39; was given instead&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:endpoint=</span>,       <span class="ruby-identifier">uri_path_fragment</span>    )
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:implementation=</span>, <span class="ruby-identifier">implementation_class</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-errors_for" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">errors_for</span><span
            class="method-args">( domain, &amp;block )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Declares custom errors that are part of this defined interface. This calls directly through to <a href="../ErrorDescriptions.html#method-i-errors_for"><code>Hoodoo::ErrorDescriptions#errors_for</code></a>, so see that for details.</p>

<p>A service should usually define only a single domain of error using one call to <a href="Interface.html#method-i-errors_for"><code>errors_for</code></a>, but techncially can make as many calls for as many domains as required. Definitions are merged.</p>
<dl class="rdoc-list note-list"><dt><code>domain</code>
<dd>
<p>Domain, e.g. ‘purchase’, ‘transaction’ - see <a href="../ErrorDescriptions.html#method-i-errors_for"><code>Hoodoo::ErrorDescriptions#errors_for</code></a> for details.</p>
</dd><dt>&amp;block
<dd>
<p>Code block making <a href="../ErrorDescriptions.html"><code>Hoodoo::ErrorDescriptions</code></a> DSL calls.</p>
</dd></dl>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">errors_for</span> <span class="ruby-string">&#39;transaction&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">error</span> <span class="ruby-string">&#39;duplicate_transaction&#39;</span>, <span class="ruby-value">status:</span> <span class="ruby-value">409</span>, <span class="ruby-value">message:</span> <span class="ruby-string">&#39;Duplicate transaction&#39;</span>, <span class="ruby-value">:required</span> <span class="ruby-operator">=&gt;</span> [ <span class="ruby-value">:client_uid</span> ]
<span class="ruby-keyword">end</span>
</pre>

          <div class="method-source-code" id="errors_for-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 623</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">errors_for</span>( <span class="ruby-identifier">domain</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
  <span class="ruby-identifier">descriptions</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">errors_for</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">descriptions</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">descriptions</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:errors_for=</span>, <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">ErrorDescriptions</span>.<span class="ruby-identifier">new</span> )
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">descriptions</span>.<span class="ruby-identifier">errors_for</span>( <span class="ruby-identifier">domain</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-public_actions" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">public_actions</span><span
            class="method-args">( *public_actions )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>List any actions which are public - NOT PROTECTED BY SESSIONS. For public actions, no X-Session-ID or similar header is consulted and no session data will be associated with your <a href="Context.html"><code>Hoodoo::Services::Context</code></a> instance when action methods are called.</p>

<p>Use with great care!</p>

<p>Note that if the implementation of a public action needs to call other resources, it can only ever call them if those actions in those other resources are also public. The implementation of a public action is prohibited from making calls to protected actions in other resources.</p>
<dl class="rdoc-list note-list"><dt>*public_actions
<dd>
<p>One or more from <code>:list</code>, <code>:show</code>, <code>:create</code>, <code>:update</code> and <code>:delete</code>. Always use symbols, not strings. An exception is raised if unrecognised actions are given.</p>
</dd></dl>

          <div class="method-source-code" id="public_actions-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">public_actions</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">public_actions</span> )
  <span class="ruby-identifier">public_actions</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">to_sym</span> }
  <span class="ruby-identifier">invalid</span> = <span class="ruby-identifier">public_actions</span> <span class="ruby-operator">-</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleware</span><span class="ruby-operator">::</span><span class="ruby-constant">ALLOWED_ACTIONS</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">invalid</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::Services::Interface#public_actions does not recognise one or more actions: &#39;#{ invalid.join( &#39;, &#39; ) }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:public_actions=</span>, <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">public_actions</span> ) )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-secure_log_for" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">secure_log_for</span><span
            class="method-args">( secure_log_actions = {} )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Set secure log actions.</p>
<dl class="rdoc-list note-list"><dt><code>secure_log_actions</code>
<dd>
<p>A Hash, described below.</p>
</dd></dl>

<p>The given Hash keys are names of actions as Symbols: <code>:list</code>, <code>:show</code>, <code>:create</code>, <code>:update</code> or <code>:delete</code>. Values are <code>:request</code>, <code>:response</code> or <code>:both</code>. For a given action targeted at this resource:</p>
<ul><li>
<p>A key of <code>:request</code> means that API call-related <a href="../../Hoodoo.html"><code>Hoodoo</code></a> automatic logging will <em>exclude</em> body data for the <em>inbound</em> <em>request</em>, but still include body data in the response. Example: A POST to a Login resource includes a password which you don’t want logged, but the response data doesn’t quote the password back so is “safe”. The secure log actions Hash for the Login resource’s interface would include <code>:create =&gt; :request</code>.</p>
</li><li>
<p>A key of <code>:response</code> means that API call-related <a href="../../Hoodoo.html"><code>Hoodoo</code></a> automatic logging will <em>exclude</em> body data for the <em>outbound</em> <em>response</em>, but still include body data in the request. Example: A POST to a Caller resource creates a Caller with a generated authentication secret that’s only exposed in the POST’s response. The inbound data used to create that Caller can be safely logged, but the authentication secret is sensitive and shouldn’t be recorded. The secure log actions Hash for the Caller resource’s interface would include <code>:create =&gt; :response</code>.</p>

<p><em>ERROR</em> <em>RESPONSES</em> <em>ARE</em> <em>STILL</em> <em>LOGGED</em> because that’s useful data; so make sure that if you generate any custom errors in your service that secure data is not contained within them.</p>
</li><li>
<p>A key of <code>both</code> has the same result as both <code>:request</code> and <code>:response</code>, so body data is never logged. It’s hard to come up with good examples of resources where both the incoming data is sensitive and the outgoing data is sensitive but the option is included for competion, as someone out there will need it.</p>
</li></ul>

<p>Example: The request body data sent by a caller into a resource’s <code>:create</code> action will not be logged:</p>

<pre class="ruby"><span class="ruby-identifier">secure_log_for</span>( { <span class="ruby-value">:create</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:request</span> } )
</pre>

<p>Example: Neither the request data sent by a caller, nor the response data sent back, will be logged for an <code>:update</code> action:</p>

<pre class="ruby"><span class="ruby-identifier">secure_log_for</span>( { <span class="ruby-value">:update</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:both</span> } )
</pre>

<p>The default is an empty Hash; all actions have both inbound request body data and outbound response body data logged by <a href="../../Hoodoo.html"><code>Hoodoo</code></a>.</p>

          <div class="method-source-code" id="secure_log_for-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 462</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">secure_log_for</span>( <span class="ruby-identifier">secure_log_actions</span> = {} )
  <span class="ruby-identifier">secure_log_actions</span> = <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Utilities</span>.<span class="ruby-identifier">symbolize</span>( <span class="ruby-identifier">secure_log_actions</span> )
  <span class="ruby-identifier">invalid</span> = <span class="ruby-identifier">secure_log_actions</span>.<span class="ruby-identifier">keys</span> <span class="ruby-operator">-</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleware</span><span class="ruby-operator">::</span><span class="ruby-constant">ALLOWED_ACTIONS</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">invalid</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::Services::Interface#secure_log_for does not recognise one or more actions: &#39;#{ invalid.join( &#39;, &#39; ) }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:secure_log_for=</span>, <span class="ruby-identifier">secure_log_actions</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_create" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_create</span><span
            class="method-args">( &amp;block )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Optional description of the JSON parameters (schema) that the interface’s implementation requires for calls creating resource instances. The block uses the DSL from <a href="../Presenters/Object.html"><code>Hoodoo::Presenters::Object</code></a>, so you can specify basic object things like <code>string</code>, or higher level things like <code>type</code> or <code>resource</code>.</p>

<p>If a call comes into the middleware from a client which contains body data that doesn’t validate according to your schema, it’ll be rejected before even getting as far as your interface implementation.</p>

<p>Default values for fields where present are for <em>rendering</em> <em>only</em>; they are not injected into the inbound body for (say) persistence at database levels. A returned, rendered representation based on the same schema would have the default values present only. If you need default values at the persistence layer too, define them there too with whatever mechanism is most appropriate for your chosen persistence approach.</p>

<p>The <a href="../Presenters/BaseDSL.html#method-i-internationalised"><code>Hoodoo::Presenters::Object#internationalised</code></a> DSL method can be called within your block harmlessly, but it has no side effects. Any resource interface that can take internationalised data for creation (or modification) must already have an internationalised representation, so the standard resources in the <a href="../Data/Resources.html"><code>Hoodoo::Data::Resources</code></a> collection will already have declared that internationalisation applies.</p>

<p>Example 1:</p>

<pre>to_create do
  string :name, :length =&gt; 32, :required =&gt; true
  text :description
end</pre>

<p>Example 2: With a resource</p>

<pre class="ruby"><span class="ruby-identifier">to_create</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">resource</span> <span class="ruby-constant">Product</span> <span class="ruby-comment"># Fields are *inline*</span>
<span class="ruby-keyword">end</span>
</pre>
<dl class="rdoc-list note-list"><dt>&amp;block
<dd>
<p>Block, passed to <a href="../Presenters/Object.html"><code>Hoodoo::Presenters::Object</code></a>, describing the fields used for resource creation.</p>
</dd></dl>

          <div class="method-source-code" id="to_create-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 557</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_create</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
  <span class="ruby-identifier">obj</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>( <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Presenters</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span> )
  <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">schema</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:to_create=</span>, <span class="ruby-identifier">obj</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_list" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_list</span><span
            class="method-args">( &amp;block )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Specify parameters related to common index parameters. The block contains calls to the DSL described by <a href="Interface/ToListDSL.html"><code>Hoodoo::Services::Interface::ToListDSL</code></a>. The default values should be described by your platform’s API - hard-coded at the time of writing as:</p>

<pre class="ruby"><span class="ruby-identifier">limit</span>    <span class="ruby-value">50</span>
<span class="ruby-identifier">sort</span>     <span class="ruby-value">:created_at</span> <span class="ruby-operator">=&gt;</span> [ <span class="ruby-value">:desc</span>, <span class="ruby-value">:asc</span> ]
<span class="ruby-identifier">search</span>   <span class="ruby-keyword">nil</span>
<span class="ruby-identifier">filter</span>   <span class="ruby-keyword">nil</span>
</pre>

          <div class="method-source-code" id="to_list-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 510</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_list</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
  <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Interface</span><span class="ruby-operator">::</span><span class="ruby-constant">ToListDSL</span>.<span class="ruby-identifier">new</span>(
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">instance_variable_get</span>( <span class="ruby-string">&#39;@to_list&#39;</span> ),
    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-to_update" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">to_update</span><span
            class="method-args">( &amp;block )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>As <a href="Interface.html#method-i-to_create"><code>to_create</code></a>, but applies when modifying existing resource instances. To avoid repeating yourself, if your modification and creation parameter requirements are identical, call <a href="Interface.html#method-i-update_same_as_create"><code>update_same_as_create</code></a>.</p>

<p>The “required” flag is ignored for updates, because an omitted field for an update to an existing resource instance simply means “do not change the current value”. As with <a href="Interface.html#method-i-to_create"><code>to_create</code></a>, default values have relevance to the rendering stage only and have no effect here.</p>
<dl class="rdoc-list note-list"><dt>&amp;block
<dd>
<p>Block, passed to <a href="../Presenters/Object.html"><code>Hoodoo::Presenters::Object</code></a>, describing the fields used for resource modification.</p>
</dd></dl>

          <div class="method-source-code" id="to_update-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 576</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_update</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
  <span class="ruby-identifier">obj</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>( <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Presenters</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span> )
  <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">schema</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )

  <span class="ruby-comment"># When updating, &#39;required&#39; fields in schema aren&#39;t required; you just</span>
  <span class="ruby-comment"># omit a field to avoid changing its value. Walk the to-update schema</span>
  <span class="ruby-comment"># graph stripping out any such problematic attributes.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">walk</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">property</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">property</span>.<span class="ruby-identifier">required</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:to_update=</span>, <span class="ruby-identifier">obj</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-update_same_as_create" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">update_same_as_create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Declares that the expected JSON fields described in a <a href="Interface.html#method-i-to_create"><code>to_create</code></a> call are the same as those required for modifying resources too.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">update_same_as_create</span>
</pre>

<p>…and that’s all. There are no parameters or blocks needed.</p>

          <div class="method-source-code" id="update_same_as_create-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 600</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_same_as_create</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:to_update</span>, <span class="ruby-operator">&amp;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_create</span>().<span class="ruby-identifier">get_schema_definition</span>() )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-version" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">version</span><span
            class="method-args">( major_version )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Declare the <em>major</em> version of the interface being implemented. All service endpoints appear at “/v{version}/{endpoint}” relative to whatever root an edge layer defines. If a service interface does not specifiy its version, <code>1</code> is assumed.</p>

<p>Two interfaces can exist on the same endpoint provided their versions are different since the resulting route to reach them will be different too.</p>
<dl class="rdoc-list note-list"><dt><code>version</code>
<dd>
<p>Integer major version number, e.g <code>2</code>.</p>
</dd></dl>

          <div class="method-source-code" id="version-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/services/services/interface.rb, line 355</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">version</span>( <span class="ruby-identifier">major_version</span> )
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:version=</span>, <span class="ruby-identifier">major_version</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">to_i</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

