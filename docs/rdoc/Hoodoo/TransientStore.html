<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Hoodoo::TransientStore - Hoodoo</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link">Object
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-deregister">::deregister</a>
    <li ><a href="#method-c-new">::new</a>
    <li ><a href="#method-c-register">::register</a>
    <li ><a href="#method-c-supported_storage_engines">::supported_storage_engines</a>
    <li ><a href="#method-i-close">#close</a>
    <li ><a href="#method-i-delete">#delete</a>
    <li ><a href="#method-i-get">#get</a>
    <li ><a href="#method-i-set">#set</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Hoodoo::TransientStore">
  <h1 id="class-Hoodoo::TransientStore" class="class">
    class Hoodoo::TransientStore
  </h1>

  <section class="description">
    
<p>A simple abstraction over transient storage engines such as <a href="https://memcached.org">Memcached</a> or <a href="https://redis.io">Redis</a>, making it it easier for client code to switch engines with very few changes. If the storage engine chosen when creating instances of this object is defined in application-wide configuration data, all you would need to do is change the configuration for all new <a href="TransientStore.html"><code>TransientStore</code></a> instances to use the new engine.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-default_maximum_lifespan" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">default_maximum_lifespan</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>Read this instance’s default item maximum lifespan, in seconds. See also <a href="TransientStore.html#method-c-new"><code>::new</code></a>.</p>
        </div>
      </div>
      <div id="attribute-i-default_namespace" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">default_namespace</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>Read this instance’s default storage namespace, as a String. See also <a href="TransientStore.html#method-c-new"><code>::new</code></a>.</p>
        </div>
      </div>
      <div id="attribute-i-storage_engine" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">storage_engine</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>Read this instance’s storage engine; see <a href="TransientStore.html#method-c-supported_storage_engines"><code>::supported_storage_engines</code></a> and <a href="TransientStore.html#method-c-new"><code>::new</code></a>.</p>
        </div>
      </div>
      <div id="attribute-i-storage_engine_instance" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">storage_engine_instance</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        <p>Read the storage engine instance for the <a href="TransientStore.html#attribute-i-storage_engine"><code>storage_engine</code></a> - this allows engine-specific configuration to be set where available, though this is strongly discouraged as it couples client code to the engine in use, defeating the main rationale behind the <a href="TransientStore.html"><code>TransientStore</code></a> abstraction.</p>
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-deregister" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">deregister</span><span
            class="method-args">( as: )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Remove a storage engine plugin class from the supported collection. Any existing <a href="TransientStore.html"><code>Hoodoo::TransientStore</code></a> instances using the removed class will not be affected, but new instances cannot be made.</p>

<p><em>Named</em> parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>as</code>
<dd>
<p>The value given to register in the corresponding <code>as</code> parameter.</p>
</dd></dl>

          <div class="method-source-code" id="deregister-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/transient_store/transient_store.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">deregister</span>( <span class="ruby-value">as:</span> )
  <span class="ruby-identifier">@@supported_storage_engines</span>.<span class="ruby-identifier">delete</span>( <span class="ruby-identifier">as</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">( storage_engine:, storage_host_uri:, default_maximum_lifespan: 604800, default_namespace: &#39;nz_co_loyalty_hoodoo_transient_store_&#39; )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Instantiate a new Transient storage object through which temporary data can be stored or retrieved.</p>

<p>The <a href="TransientStore.html"><code>TransientStore</code></a> abstraction is a high level and simple abstraction over heterogenous data storage engines. It does not expose the many subtle configuration settings usually available in such. If you need to take advantage of those at an item storage level, you’ll need to use a lower level interface and thus lock your code to the engine of choice.</p>

<p>Engine plug-ins are recommended to attempt to gain and test a connection to the storage engine when this object is constructed, so if building a <a href="TransientStore.html"><code>TransientStore</code></a> instance, ensure your chosen storage engine is running first. Exceptions may be raised by storage engines, so you will probably want to catch those with more civilised error handling code.</p>

<p><em>Named</em> parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>storage_engine</code>
<dd>
<p>An entry from <a href="TransientStore.html#method-c-supported_storage_engines"><code>::supported_storage_engines</code></a>.</p>
</dd><dt><code>storage_host_uri</code>
<dd>
<p>The engine-dependent connection URI. Consult documentation for your chosen engine to find out its connection URI requirements, along with the documentation for the constructor method of the plug-in in use, since in some cases requirements may be unusual (e.g. in <a href="TransientStore/MemcachedRedisMirror.html"><code>Hoodoo::TransientStore::MemcachedRedisMirror</code></a>).</p>
</dd><dt><code>default_maximum_lifespan</code>
<dd>
<p>The default time-to-live for data items, in, seconds; can be overridden per item; default is 604800 seconds or 7 days.</p>
</dd><dt><code>default_namespace</code>
<dd>
<p>Storage engine keys are namespaced with <code>nz_co_loyalty_hoodoo_transient_store_</code> by default, though this can be overridden here. Pass a String or Symbol.</p>
</dd></dl>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/transient_store/transient_store.rb, line 143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(
  <span class="ruby-value">storage_engine:</span>,
  <span class="ruby-value">storage_host_uri:</span>,
  <span class="ruby-value">default_maximum_lifespan:</span> <span class="ruby-value">604800</span>,
  <span class="ruby-value">default_namespace:</span>        <span class="ruby-string">&#39;nz_co_loyalty_hoodoo_transient_store_&#39;</span>
)

  <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">supported_storage_engines</span>().<span class="ruby-identifier">include?</span>( <span class="ruby-identifier">storage_engine</span> )

    <span class="ruby-comment"># Be kind and use &#39;inspect&#39; to indicate that we expect Symbols here</span>
    <span class="ruby-comment"># in the exception, because of the arising leading &#39;:&#39; in the output.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">engines</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">supported_storage_engines</span>().<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">symbol</span> <span class="ruby-operator">|</span> <span class="ruby-node">&quot;&#39;#{ symbol.inspect }&#39;&quot;</span> }
    <span class="ruby-identifier">allowed</span> = <span class="ruby-identifier">engines</span>.<span class="ruby-identifier">join</span>( <span class="ruby-string">&#39;, &#39;</span> )

    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::TransientStore: Unrecognised storage engine &#39;#{ storage_engine.inspect }&#39; requested; allowed values: #{ allowed }&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@default_maximum_lifespan</span> = <span class="ruby-identifier">default_maximum_lifespan</span>
  <span class="ruby-ivar">@default_namespace</span>        = ( <span class="ruby-identifier">default_namespace</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span> ).<span class="ruby-identifier">to_s</span>()
  <span class="ruby-ivar">@storage_engine</span>           = <span class="ruby-identifier">storage_engine</span>
  <span class="ruby-ivar">@storage_engine_instance</span>  = <span class="ruby-identifier">@@supported_storage_engines</span>[ <span class="ruby-identifier">storage_engine</span> ].<span class="ruby-identifier">new</span>(
    <span class="ruby-value">storage_host_uri:</span> <span class="ruby-identifier">storage_host_uri</span>,
    <span class="ruby-value">namespace:</span>        <span class="ruby-ivar">@default_namespace</span>
  )

<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-register" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">register</span><span
            class="method-args">( as:, using: )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Register a new storage engine plugin class. It <em>MUST</em> inherit from and thus follow the template laid out in <a href="TransientStore/Base.html"><code>Hoodoo::TransientStore::Base</code></a>.</p>

<p><em>Named</em> parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>as</code>
<dd>
<p>The name, as a Symbol, for the <a href="TransientStore.html#method-c-new"><code>::new</code></a> <code>storage_engine</code> input parameter, to select this plugin.</p>
</dd><dt><code>using</code>
<dd>
<p>The class reference of the <a href="TransientStore/Base.html"><code>Hoodoo::TransientStore::Base</code></a> subclass to be associated with the name given in <code>as</code>.</p>
</dd></dl>

<p>Example:</p>

<pre class="ruby"><span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">TransientStore</span>.<span class="ruby-identifier">register</span>(
  <span class="ruby-value">as:</span>    <span class="ruby-value">:memcached</span>,
  <span class="ruby-value">using:</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">TransientStore</span><span class="ruby-operator">::</span><span class="ruby-constant">Memcached</span>
)
</pre>

          <div class="method-source-code" id="register-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/transient_store/transient_store.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">register</span>( <span class="ruby-value">as:</span>, <span class="ruby-value">using:</span> )
  <span class="ruby-identifier">as</span> = <span class="ruby-identifier">as</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-identifier">@@supported_storage_engines</span> = {} <span class="ruby-keyword">unless</span> <span class="ruby-keyword">defined?</span>( <span class="ruby-identifier">@@supported_storage_engines</span> )

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">using</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">TransientStore</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::TransientStore.register requires a Hoodoo::TransientStore::Base subclass - got &#39;#{ using.to_s }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">@@supported_storage_engines</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-identifier">as</span> )
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::TransientStore.register: A storage engine called &#39;#{ as }&#39; is already registered&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">@@supported_storage_engines</span>[ <span class="ruby-identifier">as</span> ] = <span class="ruby-identifier">using</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-supported_storage_engines" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">supported_storage_engines</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Return an array of the names of all supported storage engine names known to the <a href="TransientStore.html"><code>Hoodoo::TransientStore</code></a> class. Any one of those names can be used with the <a href="TransientStore.html#method-c-new"><code>::new</code></a> <code>storage_engine</code> parameter.</p>

          <div class="method-source-code" id="supported_storage_engines-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/transient_store/transient_store.rb, line 77</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">supported_storage_engines</span>
  <span class="ruby-identifier">@@supported_storage_engines</span>.<span class="ruby-identifier">keys</span>()
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-close" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">close</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>If you aren’t going to use this instance again, it is good manners to immediately close its connection(s) to any storage engines by calling here.</p>

<p>No useful return value is generated and exceptions are ignored.</p>

          <div class="method-source-code" id="close-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/transient_store/transient_store.rb, line 323</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">close</span>
  <span class="ruby-ivar">@storage_engine_instance</span>.<span class="ruby-identifier">close</span>() <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-delete" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">( key: )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Delete data previously stored with <a href="TransientStore.html#method-i-set"><code>set</code></a>.</p>

<p><em>Named</em> parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>key</code>
<dd>
<p>Key previously given to <a href="TransientStore.html#method-i-set"><code>set</code></a>.</p>
</dd></dl>

<p>Returns:</p>
<ul><li>
<p><code>true</code> if deletion was successful, if the item has already expired or if the key is simply not recognised so there is no more work to do.</p>
</li><li>
<p><code>false</code> if deletion failed but the reason is unknown.</p>
</li><li>
<p>An <code>Exception</code> instance if deletion failed and the storage engine raised an exception describing the problem.</p>
</li></ul>

<p>Only non-empty String or Symbol keys are permitted, else an exception will be raised.</p>

          <div class="method-source-code" id="delete-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/transient_store/transient_store.rb, line 299</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete</span>( <span class="ruby-value">key:</span> )
  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">normalise_key</span>( <span class="ruby-identifier">key</span>, <span class="ruby-string">&#39;delete&#39;</span> )

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@storage_engine_instance</span>.<span class="ruby-identifier">delete</span>( <span class="ruby-value">key:</span> <span class="ruby-identifier">key</span> )

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::TransientStore\#delete: Engine &#39;#{ @storage_engine }&#39; returned an invalid response&quot;</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">e</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-get" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">( key:, allow_throw: false )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Retrieve data previously stored with <a href="TransientStore.html#method-i-set"><code>set</code></a>.</p>

<p><em>Named</em> parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>key</code>
<dd>
<p>Key previously given to <a href="TransientStore.html#method-i-set"><code>set</code></a>.</p>
</dd><dt><code>allow_throw</code>
<dd>
<p>If <code>true</code>, exceptions raised by the underlying storage engine are thrown, else ignored and <code>nil</code> is returned. Optional; default is <code>false</code>.</p>
</dd></dl>

<p>Returns <code>nil</code> if the item is not found - either the key is wrong, the stored data has expired or the stored data has been evicted early from the storage engine’s pool.</p>

<p>Only non-empty String or Symbol keys are permitted, else an exception will be raised.</p>

          <div class="method-source-code" id="get-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/transient_store/transient_store.rb, line 272</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get</span>( <span class="ruby-value">key:</span>, <span class="ruby-value">allow_throw:</span> <span class="ruby-keyword">false</span> )
  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">normalise_key</span>( <span class="ruby-identifier">key</span>, <span class="ruby-string">&#39;get&#39;</span> )

  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@storage_engine_instance</span>.<span class="ruby-identifier">get</span>( <span class="ruby-value">key:</span> <span class="ruby-identifier">key</span> )
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">allow_throw</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-set" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">set</span><span
            class="method-args">( key:, payload:, maximum_lifespan: nil )</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Set (write) a given payload into the storage engine with the given payload and maximum lifespan.</p>

<p>Payloads must only contain simple types such as Hash, Array, String and Integer. Complex types like Symbol, Date, Float, BigDecimal or custom objects are unlikely to serialise properly but since this depends upon the storage engine in use, errors may or may not be raised for misuse.</p>

<p>Storage engines usually have a maximum payload size limit; consult your engine administrator for information. For example, the default - but reconfigurable - maximum payload size for <a href="TransientStore/Memcached.html"><code>Memcached</code></a> is 1MB.</p>

<p>For maximum possible compatibility:</p>
<ul><li>
<p>Use only Hash payloads with String key/value paids and no nesting. You may choose to marshal the data into a String manually for unusual data requirements, manually converting back when reading stored data.</p>
</li><li>
<p>Keep the payload size as small as possible - large objects belong in bulk storage engines such as Amazon S3.</p>
</li></ul>

<p>These are only guidelines though - heterogenous storage engine support and the ability of system administrators to arbitrarily configure those storage engines makes it impossible to be more precise.</p>

<p>Returns:</p>
<ul><li>
<p><code>true</code> if storage was successful</p>
</li><li>
<p><code>false</code> if storage failed but the reason is unknown</p>
</li><li>
<p>An <code>Exception</code> instance if storage failed and the storage engine raised an exception describing the problem.</p>
</li></ul>

<p><em>Named</em> parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>key</code>
<dd>
<p>Storage key to use in the engine, which is then used in subsequent calls to <a href="TransientStore.html#method-i-get"><code>get</code></a> and possibly eventually to <a href="TransientStore.html#method-i-delete"><code>delete</code></a>. Only non-empty Strings or Symbols are permitted, else an exception will be raised.</p>
</dd><dt><code>payload</code>
<dd>
<p>Payload data to store under the given <code>key</code>. A flat Hash is recommended rather than simple types such as String (unless marshalling a complex type into such) in order to make potential additions to stored data easier to implement. Note that <code>nil</code> is prohibited.</p>
</dd><dt><code>maximum_lifespan</code>
<dd>
<p>Optional maximum lifespan, seconds. Storage engines may chooset to evict payloads sooner than this; it is a maximum time, not a guarantee. Omit to use this <a href="TransientStore.html"><code>TransientStore</code></a> instance’s default value - see <a href="TransientStore.html#method-c-new"><code>::new</code></a>. If you know you no longer need a piece of data at a particular point in the execution flow of your code, explicitly delete it via <a href="TransientStore.html#method-i-delete"><code>delete</code></a> rather than leaving it to expire. This maximises the storage engine’s pool free space and so minimises the chance of early item eviction.</p>
</dd></dl>

          <div class="method-source-code" id="set-source">
            <pre><span class="ruby-comment"># File lib/hoodoo/transient_store/transient_store.rb, line 227</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set</span>( <span class="ruby-value">key:</span>, <span class="ruby-value">payload:</span>, <span class="ruby-value">maximum_lifespan:</span> <span class="ruby-keyword">nil</span> )
  <span class="ruby-identifier">key</span> = <span class="ruby-identifier">normalise_key</span>( <span class="ruby-identifier">key</span>, <span class="ruby-string">&#39;set&#39;</span> )

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Hoodoo::TransientStore\#set: Payloads of &#39;nil&#39; are prohibited&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">maximum_lifespan</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@default_maximum_lifespan</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-ivar">@storage_engine_instance</span>.<span class="ruby-identifier">set</span>(
      <span class="ruby-value">key:</span>              <span class="ruby-identifier">key</span>,
      <span class="ruby-value">payload:</span>          <span class="ruby-identifier">payload</span>,
      <span class="ruby-value">maximum_lifespan:</span> <span class="ruby-identifier">maximum_lifespan</span>
    )

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Hoodoo::TransientStore\#set: Engine &#39;#{ @storage_engine }&#39; returned an invalid response&quot;</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">e</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

