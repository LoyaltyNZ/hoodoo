<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ApiTools::ServiceInterface::ToListDSL - RDoc Documentation</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-default">#default</a>
    
    <li ><a href="#method-i-filter">#filter</a>
    
    <li ><a href="#method-i-limit">#limit</a>
    
    <li ><a href="#method-i-search">#search</a>
    
    <li ><a href="#method-i-sort">#sort</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ApiTools::ServiceInterface::ToListDSL">
  <h1 id="class-ApiTools::ServiceInterface::ToListDSL" class="class">
    class ApiTools::ServiceInterface::ToListDSL
  </h1>

  <section class="description">
    
<p>Implementation of the DSL that&#39;s written inside a block passed to <a
href="../ServiceInterface.html#method-i-to_list">ApiTools::ServiceInterface#to_list</a>.
This is an internal implementation class. Instantiate with an <a
href="ToList.html">ApiTools::ServiceInterface::ToList</a> instance, the
data in which is updated as the DSL methods run.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">( api_tools_service_interface_to_list_instance, &block )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Initialize an instance and run the DSL methods.</p>
<dl class="rdoc-list note-list"><dt><code>api_tools_service_interface_to_list_instance</code>
<dd>
<p>Instance of</p>
</dd></dl>

<pre>ApiTools::ServiceInterface::ToList to update with data from
DSL method calls.</pre>
<dl class="rdoc-list note-list"><dt>&amp;block
<dd>
<p>Block of code that makes calls to the DSL herein.</p>
</dd></dl>

<p>On exit, the DSL is run and the <a
href="ToList.html">ApiTools::ServiceInterface::ToList</a> has been updated.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_implementations/service_interface.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">api_tools_service_interface_to_list_instance</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
  <span class="ruby-ivar">@tl</span> = <span class="ruby-identifier">api_tools_service_interface_to_list_instance</span> <span class="ruby-comment"># Shorthand!</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@tl</span>.<span class="ruby-identifier">instance_of?</span>( <span class="ruby-constant">ApiTools</span><span class="ruby-operator">::</span><span class="ruby-constant">ServiceInterface</span><span class="ruby-operator">::</span><span class="ruby-constant">ToList</span> )
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;ApiTools::ServiceInstance::ToListDSL\#initialize requires an ApiTools::ServiceInstance::ToList instance - got &#39;#{ @tl.class }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">instance_eval</span>( <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-default" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">default</span><span
            class="method-args">( sort_key )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Used in conjunction with <a href="ToListDSL.html#method-i-sort">sort</a>.
Specifies that a sort key should be the default sort order for the
interface.</p>

<p>Example - add sort key +&#39;code&#39;+ with directions <code>:asc</code>
and <code>:desc</code>, plus sort key <code>:member</code> which only
supports direction <code>:asc</code>. Say that +&#39;code&#39;+ is to be
the default sort order.</p>

<pre class="ruby"><span class="ruby-identifier">sort</span> <span class="ruby-identifier">default</span>( <span class="ruby-string">&#39;code&#39;</span> ) =<span class="ruby-operator">&gt;</span> [ :<span class="ruby-identifier">asc</span>, :<span class="ruby-identifier">desc</span> ],
     :<span class="ruby-identifier">member</span>          =<span class="ruby-operator">&gt;</span> [ :<span class="ruby-identifier">asc</span> ]
</pre>
          
          

          
          <div class="method-source-code" id="default-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_implementations/service_interface.rb, line 199</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">default</span>( <span class="ruby-identifier">sort_key</span> )
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sort_key</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">String</span> ) <span class="ruby-operator">||</span> <span class="ruby-identifier">sort_key</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Symbol</span> )
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;ApiTools::ServiceInstance::ToListDSL\#default requires a String or Symbol - got &#39;#{ sort_key.class }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@tl</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:default_sort_key=</span>, <span class="ruby-identifier">sort_key</span>.<span class="ruby-identifier">to_s</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">sort_key</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter</span><span
            class="method-args">( *filter )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>As <a href="ToListDSL.html#method-i-search">search</a>, but for filtering.</p>
<dl class="rdoc-list note-list"><dt><code>filter</code>
<dd>
<p>Array of permitted filter keys, as symbols or strings. The order of array
entries is arbitrary.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="filter-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_implementations/service_interface.rb, line 234</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">filter</span> )
  <span class="ruby-ivar">@tl</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:filter=</span>, <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">to_s</span> } )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-limit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">limit</span><span
            class="method-args">( limit )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specify the page size (limit) for lists.</p>
<dl class="rdoc-list note-list"><dt><code>limit</code>
<dd>
<p>Page size (integer).</p>
</dd></dl>

<p>Example:</p>

<pre>limit 100</pre>
          
          

          
          <div class="method-source-code" id="limit-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_implementations/service_interface.rb, line 145</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">limit</span>( <span class="ruby-identifier">limit</span> )
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">limit</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Integer</span> )
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;ApiTools::ServiceInstance::ToListDSL\#limit requires an Integer - got &#39;#{ limit.class }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@tl</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:limit=</span>, <span class="ruby-identifier">limit</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">( *search )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specify supported search keys in an array. The middleware will make sure
the interface implementation is only called with search keys in that list.
If a client attempts a search on an unsupported key, their request will be
rejected by the middleware.</p>

<p>If a service wants to do its own search validation, it should not list call
here. Note also that only the keys are specified and validated; value
escaping and validation, if necessary, is up to the service implementation.</p>
<dl class="rdoc-list note-list"><dt><code>search</code>
<dd>
<p>Array of permitted search keys, as symbols or strings. The order of array
entries is arbitrary.</p>
</dd></dl>

<p>Example - allow searches specifying <code>first_name</code> and
<code>last_name</code> keys:</p>

<pre>search :first_name, :last_name</pre>
          
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_implementations/service_interface.rb, line 225</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search</span>( <span class="ruby-operator">*</span><span class="ruby-identifier">search</span> )
  <span class="ruby-ivar">@tl</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:search=</span>, <span class="ruby-identifier">search</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">to_s</span> } )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sort" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sort</span><span
            class="method-args">( sort )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specify extra sort keys and orders that add with whatever platform common
defaults are already in place.</p>
<dl class="rdoc-list note-list"><dt><code>sort</code>
<dd>
<p>Hash of sort keys, with values that are an array of supported sort
directions. The first array entry is used as the default direction if no
direction is specified in the client caller&#39;s query string. Use strings
or symbols.</p>

<p>To specify that a sort key should be the new default for the interface in
question, wrap it in a call to the <a
href="ToListDSL.html#method-i-default">default</a> DSL method.</p>
</dd></dl>

<p>Example - add sort key +&#39;code&#39;+ with directions <code>:asc</code>
and <code>:desc</code>, plus sort key <code>:member</code> which only
supports direction <code>:asc</code>.</p>

<pre class="ruby"><span class="ruby-identifier">sort</span> <span class="ruby-string">&#39;code&#39;</span>   =<span class="ruby-operator">&gt;</span> [ :<span class="ruby-identifier">asc</span>, :<span class="ruby-identifier">desc</span> ],
     :<span class="ruby-identifier">member</span> =<span class="ruby-operator">&gt;</span> [ :<span class="ruby-identifier">asc</span> ]
</pre>
          
          

          
          <div class="method-source-code" id="sort-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_implementations/service_interface.rb, line 171</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sort</span>( <span class="ruby-identifier">sort</span> )
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sort</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Hash</span> )
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;ApiTools::ServiceInstance::ToListDSL\#sort requires a Hash - got &#39;#{ sort.class }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Convert hash keys to strings and values in arrays to strings too.</span>

  <span class="ruby-identifier">sort</span> = <span class="ruby-identifier">sort</span>.<span class="ruby-identifier">inject</span>( {} ) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">memo</span>, (<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> ) <span class="ruby-operator">|</span>
    <span class="ruby-identifier">memo</span>[ <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span> ] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">entry</span> <span class="ruby-operator">|</span>
      <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">memo</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">merged</span> = <span class="ruby-ivar">@tl</span>.<span class="ruby-identifier">sort</span>().<span class="ruby-identifier">merge</span>( <span class="ruby-identifier">sort</span> )
  <span class="ruby-ivar">@tl</span>.<span class="ruby-identifier">send</span>( <span class="ruby-value">:sort=</span>, <span class="ruby-identifier">merged</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

