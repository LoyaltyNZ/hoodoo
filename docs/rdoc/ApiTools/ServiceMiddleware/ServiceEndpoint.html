<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ApiTools::ServiceMiddleware::ServiceEndpoint - ApiTools</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../ServiceMiddleware.html">ApiTools::ServiceMiddleware</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-create">#create</a>
    
    <li ><a href="#method-i-delete">#delete</a>
    
    <li ><a href="#method-i-interface">#interface</a>
    
    <li ><a href="#method-i-list">#list</a>
    
    <li ><a href="#method-i-show">#show</a>
    
    <li ><a href="#method-i-update">#update</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ApiTools::ServiceMiddleware::ServiceEndpoint">
  <h1 id="class-ApiTools::ServiceMiddleware::ServiceEndpoint" class="class">
    class ApiTools::ServiceMiddleware::ServiceEndpoint
  </h1>

  <section class="description">
    
<p>Representation of a callable service endpoint for a specific resource.
Services that wish to call other services should obtain an endpoint
instance via <a
href="../ServiceContext.html#method-i-resource">ApiTools::ServiceContext#resource</a>
then use the instance methods described for this class to call other
services. The calls they use look very similar to the calls they implement
for their own instances. The response they get is in the form of an <a
href="../ServiceResponse.html">ApiTools::ServiceResponse</a> instance
describing the inter-service call&#39;s results.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">( middleware_instance, resource, version = 1 )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create an endpoint instance on behalf of the given <a
href="../ServiceMiddleware.html">ApiTools::ServiceMiddleware</a> instance,
directed at the given resource.</p>
<dl class="rdoc-list note-list"><dt><code>middleware_instance</code>
<dd>
<p><a href="../ServiceMiddleware.html">ApiTools::ServiceMiddleware</a> used to
handle onward requests.</p>
</dd><dt><code>resource</code>
<dd>
<p>Resource name the endpoint targets, e.g. <code>:Purchase</code>. String or
symbol.</p>
</dd><dt><code>version</code>
<dd>
<p>Optional required interface (API) version for that endpoint. Integer.
Default is 1.</p>
</dd></dl>

<p>When calls are made through endpoints, the caller&#39;s call context data
is updated. The <a
href="../ServiceResponse.html">ApiTools::ServiceResponse</a> instance in
the context will hold error details, if there were any. Callers must always
check their <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value and if <code>true</code> should exit early.</p>

<p>Endpoint methods for listing, creating etc. resources have common
parameters some or all of which are used across the method
&#39;family&#39;:</p>
<dl class="rdoc-list note-list"><dt><code>ident</code>
<dd>
<p>An identifier. This is usually a <a href="../UUID.html">UUID</a> but some
resources support e.g. a “show” action based on either a <a
href="../UUID.html">UUID</a> or some other unique identifier. Currency, for
example, can look up on a <a href="../UUID.html">UUID</a> or a currency
code.</p>
</dd><dt><code>query_hash</code>
<dd>
<p>A hash of unencoded data that could be encoded to form a query string.
Search and filter data is represented with nested hashes. Embed and
reference data uses an array. Example:</p>

<pre>{
  offset: 75,
  limit:  50,
  search: {
    member_id: &quot;...some UUDI...&quot;
  },
  _embed: [
    &#39;vouchers&#39;,
    &#39;balances&#39;
  ]
}</pre>

<p>This parameter is always optional.</p>
</dd><dt><code>body_hash</code>
<dd>
<p>The Hash representation of the body data that might be sent in an HTTP
request (i.e. JSON, as a Hash).</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">middleware_instance</span>, <span class="ruby-identifier">resource</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value">1</span> )
  <span class="ruby-ivar">@middleware</span>    = <span class="ruby-identifier">middleware_instance</span>
  <span class="ruby-ivar">@resource</span>      = <span class="ruby-identifier">resource</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-ivar">@version</span>       = <span class="ruby-identifier">version</span>.<span class="ruby-identifier">to_i</span>

  <span class="ruby-ivar">@local_service</span> = <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">local_service_for</span>( <span class="ruby-ivar">@resource</span>, <span class="ruby-ivar">@version</span> )
  <span class="ruby-ivar">@remote_uri</span>    = <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">remote_service_for</span>( <span class="ruby-ivar">@resource</span>, <span class="ruby-ivar">@version</span> )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">( body_hash, query_hash = nil )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create a resource instance.</p>
<dl class="rdoc-list note-list"><dt><code>body_hash</code>
<dd>
<p>See intiialize.</p>
</dd><dt><code>query_hash</code>
<dd>
<p>See initialize.</p>
</dd></dl>

<p>Returns a Hash representation of the new resource instance, unless
there&#39;s an error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
          
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>( <span class="ruby-identifier">body_hash</span>, <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;POST&#39;</span>,
    <span class="ruby-value">:body_hash</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">body_hash</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">( ident, query_hash = nil )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Delete a resource instance.</p>
<dl class="rdoc-list note-list"><dt><code>ident</code>
<dd>
<p>See intiialize.</p>
</dd><dt><code>query_hash</code>
<dd>
<p>See initialize.</p>
</dd></dl>

<p>Returns a Hash representation of the now-deleted resource instance, unless
there&#39;s an error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
          
          

          
          <div class="method-source-code" id="delete-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 199</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete</span>( <span class="ruby-identifier">ident</span>, <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;DELETE&#39;</span>,
    <span class="ruby-value">:ident</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ident</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-interface" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">interface</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Find out the service interface class being used by this instance. If
<code>nil</code>, the interface is remote - it isn&#39;t part of the
middleware instance that owns the endpoint instance. The endpoint may not
be available, but you won&#39;t know until you try to talk to it over the
network.</p>
          
          

          
          <div class="method-source-code" id="interface-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">interface</span>
  <span class="ruby-ivar">@local_service</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@local_service</span>[ <span class="ruby-value">:interface</span> ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">list</span><span
            class="method-args">( query_hash = nil )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Obtain a list of resource instance representations.</p>
<dl class="rdoc-list note-list"><dt><code>query_hash</code>
<dd>
<p>See initialize. This is the only way to search/filter the list, according
to the targer Resource&#39;s documented supported search/filter parameters
and the platform&#39;s common all-resource behaviour.</p>
</dd></dl>

<p>Returns an array of zero or more resource representations as Hashes, unless
there&#39;s an error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
          
          

          
          <div class="method-source-code" id="list-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">list</span>( <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;GET&#39;</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-show" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show</span><span
            class="method-args">( ident, query_hash = nil )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Obtain a resource instance representation.</p>
<dl class="rdoc-list note-list"><dt><code>ident</code>
<dd>
<p>See intiialize.</p>
</dd><dt><code>query_hash</code>
<dd>
<p>See initialize.</p>
</dd></dl>

<p>Returns a Hash representation of a resource instance, unless there&#39;s an
error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
          
          

          
          <div class="method-source-code" id="show-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 131</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show</span>( <span class="ruby-identifier">ident</span>, <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;GET&#39;</span>,
    <span class="ruby-value">:ident</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ident</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update</span><span
            class="method-args">( ident, body_hash, query_hash = nil )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update a resource instance.</p>
<dl class="rdoc-list note-list"><dt><code>ident</code>
<dd>
<p>See intiialize.</p>
</dd><dt><code>body_hash</code>
<dd>
<p>See intiialize.</p>
</dd><dt><code>query_hash</code>
<dd>
<p>See initialize.</p>
</dd></dl>

<p>Returns a Hash representation of the updated resource instance, unless
there&#39;s an error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
          
          

          
          <div class="method-source-code" id="update-source">
            <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 176</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update</span>( <span class="ruby-identifier">ident</span>, <span class="ruby-identifier">body_hash</span>, <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;PATCH&#39;</span>,
    <span class="ruby-value">:ident</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ident</span>,
    <span class="ruby-value">:body_hash</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">body_hash</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

