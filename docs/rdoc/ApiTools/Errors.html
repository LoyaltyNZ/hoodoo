<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ApiTools::Errors - RDoc Documentation</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-add_error">#add_error</a>
    
    <li ><a href="#method-i-add_precompiled_error">#add_precompiled_error</a>
    
    <li ><a href="#method-i-clear_errors">#clear_errors</a>
    
    <li ><a href="#method-i-has_errors-3F">#has_errors?</a>
    
    <li ><a href="#method-i-merge-21">#merge!</a>
    
    <li ><a href="#method-i-render">#render</a>
    
    <li ><a href="#method-i-store-21">#store!</a>
    
    <li ><a href="#method-i-unjoin_and_unescape_commas">#unjoin_and_unescape_commas</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ApiTools::Errors">
  <h1 id="class-ApiTools::Errors" class="class">
    class ApiTools::Errors
  </h1>

  <section class="description">
    
<p>During request processing, API service implementations create an <a
href="Errors.html">ApiTools::Errors</a> instance and add error(s) to the
collection as they arise using <a
href="Errors.html#method-i-add_error">add_error</a>. That same instance can
then be returned for the on-error handling path of whatever wider service
framework is in use by the service code in question. Services should use
new instances for each request.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="DEFAULT_ERROR_DESCRIPTIONS">DEFAULT_ERROR_DESCRIPTIONS
        
        <dd><p>Default <a href="ErrorDescriptions.html">ApiTools::ErrorDescriptions</a>
instance, used if the instantiator provides no alternative.</p>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-errors" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">errors</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>Array of error data - hashes with <code>code</code>, <code>message</code>
and <code>reference</code> fields giving the error codes, human-readable
messages and machine-readable reference data, where appropriate.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-http_status_code" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">http_status_code</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>HTTP status code associated with the first error in the <a
href="Errors.html#attribute-i-errors">errors</a> array.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-uuid" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">uuid</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p><a href="Errors.html">Errors</a> are manifestations of the <a
href="Errors.html">Errors</a> resource. They acquire a <a
href="UUID.html">UUID</a> when instantiated, even if the instance is never
used or persisted.</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">( descriptions = DEFAULT_ERROR_DESCRIPTIONS )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create an instance.</p>
<dl class="rdoc-list note-list"><dt><code>descriptions</code>
<dd>
<p>(Optional) <a href="ErrorDescriptions.html">ApiTools::ErrorDescriptions</a>
instance with service-domain-specific error descriptions added, or omit for
a default instance describing <code>platform</code> and
<code>generic</code> error domains only.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">descriptions</span> = <span class="ruby-constant">DEFAULT_ERROR_DESCRIPTIONS</span> )
  <span class="ruby-ivar">@uuid</span>             = <span class="ruby-constant">ApiTools</span><span class="ruby-operator">::</span><span class="ruby-constant">UUID</span>.<span class="ruby-identifier">generate</span>()
  <span class="ruby-ivar">@descriptions</span>     = <span class="ruby-identifier">descriptions</span>
  <span class="ruby-ivar">@errors</span>           = []
  <span class="ruby-ivar">@http_status_code</span> = <span class="ruby-value">500</span>
  <span class="ruby-ivar">@created_at</span>       = <span class="ruby-keyword">nil</span> <span class="ruby-comment"># See #persist!</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add_error" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_error</span><span
            class="method-args">( code, options = nil )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add an error instance to this collection.</p>
<dl class="rdoc-list note-list"><dt><code>code</code>
<dd>
<p>Error code in full, e.g. +generic.invalid_state&#39;.</p>
</dd><dt><code>options</code>
<dd>
<p>An options Hash, optional.</p>
</dd></dl>

<p>The options hash contains symbol keys named as follows, with values as
described:</p>
<dl class="rdoc-list note-list"><dt>+&#39;reference&#39;+
<dd>
<p>Reference data Hash, optionality depending upon the error</p>
</dd></dl>

<pre>code and the reference data its error description mandates.
Provide key/value pairs where (symbol) keys are names from
the array of description requirements and values are
strings. All values are concatenated into a single string,
comma-separated. Commas within values are escaped with a
backslash; backslash is itself escaped with a backslash.

You must provide that data at a minimum, but can provide
additional keys too if you so wish. Required keys are
always included first, in order of appearance in the
requirements array of the error declaration, followed by
any extra values in undefined order.

See also ApiTools::ErrorDescriptions::DomainDescriptions#error</pre>
<dl class="rdoc-list note-list"><dt>+&#39;message&#39;+
<dd>
<p>Optional human-readable for-developer message, <code>en-nz</code></p>
</dd></dl>

<pre>locale. Default messages are provided for all errors, but
if you think you can provide something more informative,
you can do so through this parameter.</pre>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_error</span>(
  <span class="ruby-string">&#39;platform.not_found&#39;</span>,
  :<span class="ruby-identifier">message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Optional custom message&#39;</span>,
  :<span class="ruby-identifier">reference</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">entity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;mandatory reference data&#39;</span> }
)
</pre>

<p>In the above example, the mandatory reference data <code>entity_name</code>
comes from the description for the &#39;platform.not_found&#39; message -
see the ApiTools::ErrorDescriptions#initialize <em>implementation</em> and
Platform API.</p>
          
          

          
          <div class="method-source-code" id="add_error-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 112</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_error</span>( <span class="ruby-identifier">code</span>, <span class="ruby-identifier">options</span> = <span class="ruby-keyword">nil</span> )

  <span class="ruby-identifier">options</span>   = <span class="ruby-constant">ApiTools</span><span class="ruby-operator">::</span><span class="ruby-constant">Utilities</span>.<span class="ruby-identifier">stringify</span>( <span class="ruby-identifier">options</span> <span class="ruby-operator">||</span> {} )
  <span class="ruby-identifier">reference</span> = <span class="ruby-constant">ApiTools</span><span class="ruby-operator">::</span><span class="ruby-constant">Utilities</span>.<span class="ruby-identifier">stringify</span>( <span class="ruby-identifier">options</span>[ <span class="ruby-string">&#39;reference&#39;</span> ] <span class="ruby-operator">||</span> {} )
  <span class="ruby-identifier">message</span>   = <span class="ruby-identifier">options</span>[ <span class="ruby-string">&#39;message&#39;</span> ]

  <span class="ruby-comment"># Make sure nobody uses an undeclared error code.</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">UnknownCode</span>, <span class="ruby-node">&quot;In \#add_error: Unknown error code &#39;#{code}&#39;&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@descriptions</span>.<span class="ruby-identifier">recognised?</span>( <span class="ruby-identifier">code</span> )

  <span class="ruby-comment"># If the error description specifies a list of required reference keys,</span>
  <span class="ruby-comment"># make sure all are present and complain if not.</span>

  <span class="ruby-identifier">description</span> = <span class="ruby-ivar">@descriptions</span>.<span class="ruby-identifier">describe</span>( <span class="ruby-identifier">code</span> )

  <span class="ruby-identifier">required_keys</span> = <span class="ruby-identifier">description</span>[ <span class="ruby-string">&#39;reference&#39;</span> ] <span class="ruby-operator">||</span> []
  <span class="ruby-identifier">actual_keys</span>   = <span class="ruby-identifier">reference</span>.<span class="ruby-identifier">keys</span>
  <span class="ruby-identifier">missing_keys</span>  = <span class="ruby-identifier">required_keys</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">actual_keys</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">missing_keys</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">MissingReferenceData</span>, <span class="ruby-node">&quot;In \#add_error: Reference hash missing required keys: &#39;#{ missing_keys.join( &#39;, &#39; ) }&#39;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># All good!</span>

  <span class="ruby-ivar">@http_status_code</span> = <span class="ruby-identifier">description</span>[ <span class="ruby-string">&#39;status&#39;</span> ] <span class="ruby-operator">||</span> <span class="ruby-value">500</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@errors</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-comment"># Use first in collection for overall HTTP status code</span>

  <span class="ruby-identifier">error</span> = {
    <span class="ruby-string">&#39;code&#39;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">code</span>,
    <span class="ruby-string">&#39;message&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">message</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">description</span>[ <span class="ruby-string">&#39;message&#39;</span> ] <span class="ruby-operator">||</span> <span class="ruby-identifier">code</span>
  }

  <span class="ruby-identifier">ordered_keys</span>   = <span class="ruby-identifier">required_keys</span> <span class="ruby-operator">+</span> ( <span class="ruby-identifier">actual_keys</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">required_keys</span> )
  <span class="ruby-identifier">ordered_values</span> = <span class="ruby-identifier">ordered_keys</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">key</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">escape_commas</span>( <span class="ruby-identifier">reference</span>[ <span class="ruby-identifier">key</span> ].<span class="ruby-identifier">to_s</span> ) }

  <span class="ruby-comment"># See #unjoin_and_unescape_commas to undo the join below.</span>

  <span class="ruby-identifier">error</span>[ <span class="ruby-string">&#39;reference&#39;</span> ] = <span class="ruby-identifier">ordered_values</span>.<span class="ruby-identifier">join</span>( <span class="ruby-string">&#39;,&#39;</span> ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ordered_values</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-ivar">@errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">error</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-add_precompiled_error" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_precompiled_error</span><span
            class="method-args">( code, message, reference, http_status = 500 )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a precompiled error to the error collection. Pass error code, error
message and reference data directly.</p>

<p>In most cases you should be calling <a
href="Errors.html#method-i-add_error">add_error</a> instead,
<strong>NOT</strong> here.</p>

<p>**No validation is performed**. You should only really call here if storing
an error / errors from another, trusted source with assumed validity (e.g.
another service called remotely with errors in the JSON response). It&#39;s
possible to store invalid error data using this call, which means
counter-to-documentation results could be returned to API clients. That is
Very Bad.</p>

<p>Pass optionally the HTTP status code to use if this happens to be the first
stored error. If this is omitted, 500 is kept as the default.</p>
          
          

          
          <div class="method-source-code" id="add_precompiled_error-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_precompiled_error</span>( <span class="ruby-identifier">code</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">reference</span>, <span class="ruby-identifier">http_status</span> = <span class="ruby-value">500</span> )
  <span class="ruby-ivar">@http_status_code</span> = <span class="ruby-identifier">http_status</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@errors</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">error</span> = {
    <span class="ruby-string">&#39;code&#39;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">code</span>,
    <span class="ruby-string">&#39;message&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">message</span>
  }

  <span class="ruby-identifier">error</span>[ <span class="ruby-string">&#39;reference&#39;</span> ] = <span class="ruby-identifier">reference</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">reference</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">reference</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-ivar">@errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">error</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-clear_errors" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_errors</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Clear (delete) all previously added errors (if any). After calling here, <a
href="Errors.html#method-i-has_errors-3F">has_errors?</a> would always
return <code>false</code>.</p>
          
          

          
          <div class="method-source-code" id="clear_errors-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 208</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear_errors</span>
  <span class="ruby-ivar">@errors</span>           = []
  <span class="ruby-ivar">@http_status_code</span> = <span class="ruby-value">500</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-has_errors-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_errors?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Does this instance have any errors added? Returns <code>true</code> if so,
else <code>false</code>.</p>
          
          

          
          <div class="method-source-code" id="has_errors-3F-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_errors?</span>
  <span class="ruby-operator">!</span> <span class="ruby-ivar">@errors</span>.<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-merge-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">merge!</span><span
            class="method-args">( source )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Merge the contents of a source error object with this one, adding its
errors to this collection. No checks are made for duplicates (in part
because, depending on error code and source/target contexts, a duplicate
may be a valid thing to have).</p>
          
          

          
          <div class="method-source-code" id="merge-21-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">merge!</span>( <span class="ruby-identifier">source</span> )
  <span class="ruby-identifier">source</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span> <span class="ruby-operator">|</span>
    <span class="ruby-identifier">add_precompiled_error</span>(
      <span class="ruby-identifier">hash</span>[ <span class="ruby-string">&#39;code&#39;</span>      ],
      <span class="ruby-identifier">hash</span>[ <span class="ruby-string">&#39;message&#39;</span>   ],
      <span class="ruby-identifier">hash</span>[ <span class="ruby-string">&#39;reference&#39;</span> ],
      <span class="ruby-identifier">source</span>.<span class="ruby-identifier">http_status_code</span>
    )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-render" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">render</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return a Hash rendered through the <a
href="Data/Resources/Errors.html">ApiTools::Data::Resources::Errors</a>
collection representing the formalised resource.</p>
          
          

          
          <div class="method-source-code" id="render-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">render</span>
  <span class="ruby-identifier">store!</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@created_at</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-constant">ApiTools</span><span class="ruby-operator">::</span><span class="ruby-constant">Data</span><span class="ruby-operator">::</span><span class="ruby-constant">Resources</span><span class="ruby-operator">::</span><span class="ruby-constant">Errors</span>.<span class="ruby-identifier">render</span>(
    { <span class="ruby-string">&#39;errors&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@errors</span> },
    <span class="ruby-ivar">@uuid</span>,
    <span class="ruby-ivar">@created_at</span>
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-store-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">store!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>TODO: Persistence - e.g. database locally, or queue if available.</p>
          
          

          
          <div class="method-source-code" id="store-21-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">store!</span>
  <span class="ruby-comment"># unless persisted...</span>
  <span class="ruby-comment">#   created_at = ...</span>

  <span class="ruby-ivar">@created_at</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-comment"># TODO</span>

  <span class="ruby-constant">ApiTools</span><span class="ruby-operator">::</span><span class="ruby-constant">Logger</span>.<span class="ruby-identifier">error</span>(
    <span class="ruby-string">&quot;Storing ApiTools::Errors instance&quot;</span>,
    <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span>( <span class="ruby-identifier">render</span>() )
  )
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unjoin_and_unescape_commas" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unjoin_and_unescape_commas</span><span
            class="method-args">( str )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>When reference data is specified for errors, the reference values are
concatenated together into a comma-separated string. Since reference values
can themselves contain commas, comma is escaped with “,” and “&quot;
escaped with ”\“.</p>

<p>Call here with such a string; return an array of &#39;unescaped&#39;
values.</p>

<p><code>str</code>: Value-escaped (“\” / “,”) comma-separated string.
Unescaped</p>

<pre>commas separate individual values.</pre>
          
          

          
          <div class="method-source-code" id="unjoin_and_unescape_commas-source">
            <pre><span class="ruby-comment"># File lib/api_tools/errors/errors.rb, line 250</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unjoin_and_unescape_commas</span>( <span class="ruby-identifier">str</span> )

  <span class="ruby-comment"># In Ruby regular expressions, &#39;(?&lt;!pat)&#39; is a negative lookbehind</span>
  <span class="ruby-comment"># assertion, making sure that the preceding characters do not match</span>
  <span class="ruby-comment"># &#39;pat&#39;. To split the string joined on &#39;,&#39; to an array but not splitting</span>
  <span class="ruby-comment"># any escaped &#39;\,&#39;, then, we can use this rather opaque split regexp:</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment">#   error[ &#39;reference&#39; ].split( /(?&lt;!\\),/ )</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># I.e. split on &#39;,&#39;, provided it is not preceded by a &#39;\&#39; (escaped in the</span>
  <span class="ruby-comment"># regexp to &#39;\\&#39;).</span>

  <span class="ruby-identifier">ary</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">split</span>( <span class="ruby-regexp">/(?&lt;!\),/</span> )
  <span class="ruby-identifier">ary</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">entry</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">unescape_commas</span>( <span class="ruby-identifier">entry</span> ) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

