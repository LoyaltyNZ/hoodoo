<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ApiTools::ServiceMiddleware::ServiceEndpoint</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            ApiTools::ServiceMiddleware::ServiceEndpoint 
            
                <span class="parent">&lt; 
                    
                    <a href="../ServiceMiddleware.html">ApiTools::ServiceMiddleware</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/api_tools/service_middleware/service_endpoint_rb.html">lib/api_tools/service_middleware/service_endpoint.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Representation of a callable service endpoint for a specific resource.
Services that wish to call other services should obtain an endpoint
instance via <a
href="../ServiceContext.html#method-i-resource">ApiTools::ServiceContext#resource</a>
then use the instance methods described for this class to call other
services. The calls they use look very similar to the calls they implement
for their own instances. The response they get is in the form of an <a
href="../ServiceResponse.html">ApiTools::ServiceResponse</a> instance
describing the inter-service call&#39;s results.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-create">create</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-delete">delete</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-interface">interface</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-list">list</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-show">show</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-update">update</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>new</b>( middleware_instance, resource, version = 1 )
            
            <a href="../../../classes/ApiTools/ServiceMiddleware/ServiceEndpoint.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Create an endpoint instance on behalf of the given <a
href="../ServiceMiddleware.html">ApiTools::ServiceMiddleware</a> instance,
directed at the given resource.</p>
<dl class="rdoc-list note-list"><dt><code>middleware_instance</code>
<dd>
<p><a href="../ServiceMiddleware.html">ApiTools::ServiceMiddleware</a> used to
handle onward requests.</p>
</dd><dt><code>resource</code>
<dd>
<p>Resource name the endpoint targets, e.g. <code>:Purchase</code>. String or
symbol.</p>
</dd><dt><code>version</code>
<dd>
<p>Optional required interface (API) version for that endpoint. Integer.
Default is 1.</p>
</dd></dl>

<p>When calls are made through endpoints, the caller&#39;s call context data
is updated. The <a
href="../ServiceResponse.html">ApiTools::ServiceResponse</a> instance in
the context will hold error details, if there were any. Callers must always
check their <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value and if <code>true</code> should exit early.</p>

<p>Endpoint methods for listing, creating etc. resources have common
parameters some or all of which are used across the method
&#39;family&#39;:</p>
<dl class="rdoc-list note-list"><dt><code>ident</code>
<dd>
<p>An identifier. This is usually a <a href="../UUID.html">UUID</a> but some
resources support e.g. a “show” action based on either a <a
href="../UUID.html">UUID</a> or some other unique identifier. Currency, for
example, can look up on a <a href="../UUID.html">UUID</a> or a currency
code.</p>
</dd><dt><code>query_hash</code>
<dd>
<p>A hash of unencoded data that could be encoded to form a query string.
Search and filter data is represented with nested hashes. Embed and
reference data uses an array. Example:</p>

<pre><code>{
  offset: 75,
  limit:  50,
  search: {
    member_id: &quot;...some UUDI...&quot;
  },
  _embed: [
    &#39;vouchers&#39;,
    &#39;balances&#39;
  ]
}
</code></pre>

<p>This parameter is always optional.</p>
</dd><dt><code>body_hash</code>
<dd>
<p>The Hash representation of the body data that might be sent in an HTTP
request (i.e. JSON, as a Hash).</p>
</dd></dl>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">initialize</span>( <span class="ruby-identifier">middleware_instance</span>, <span class="ruby-identifier">resource</span>, <span class="ruby-identifier">version</span> = <span class="ruby-number">1</span> )
  <span class="ruby-ivar">@middleware</span>    = <span class="ruby-identifier">middleware_instance</span>
  <span class="ruby-ivar">@resource</span>      = <span class="ruby-identifier">resource</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-ivar">@version</span>       = <span class="ruby-identifier">version</span>.<span class="ruby-identifier">to_i</span>

  <span class="ruby-ivar">@local_service</span> = <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">local_service_for</span>( <span class="ruby-ivar">@resource</span>, <span class="ruby-ivar">@version</span> )
  <span class="ruby-ivar">@remote_uri</span>    = <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">remote_service_for</span>( <span class="ruby-ivar">@resource</span>, <span class="ruby-ivar">@version</span> )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-create">
            
              <b>create</b>( body_hash, query_hash = nil )
            
            <a href="../../../classes/ApiTools/ServiceMiddleware/ServiceEndpoint.html#method-i-create" name="method-i-create" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Create a resource instance.</p>
<dl class="rdoc-list note-list"><dt>body_hash
<dd>
<p>See intiialize.</p>
</dd><dt>query_hash
<dd>
<p>See initialize.</p>
</dd></dl>

<p>Returns a Hash representation of the new resource instance, unless
there&#39;s an error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-create_source')" id="l_method-i-create_source">show</a>
                
              </p>
              <div id="method-i-create_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">create</span>( <span class="ruby-identifier">body_hash</span>, <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;POST&#39;</span>,
    <span class="ruby-value">:body_hash</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">body_hash</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-delete">
            
              <b>delete</b>( ident, query_hash = nil )
            
            <a href="../../../classes/ApiTools/ServiceMiddleware/ServiceEndpoint.html#method-i-delete" name="method-i-delete" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Delete a resource instance.</p>
<dl class="rdoc-list note-list"><dt>ident
<dd>
<p>See intiialize.</p>
</dd><dt>query_hash
<dd>
<p>See initialize.</p>
</dd></dl>

<p>Returns a Hash representation of the now-deleted resource instance, unless
there&#39;s an error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-delete_source')" id="l_method-i-delete_source">show</a>
                
              </p>
              <div id="method-i-delete_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 199</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">delete</span>( <span class="ruby-identifier">ident</span>, <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;DELETE&#39;</span>,
    <span class="ruby-value">:ident</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ident</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-interface">
            
              <b>interface</b>()
            
            <a href="../../../classes/ApiTools/ServiceMiddleware/ServiceEndpoint.html#method-i-interface" name="method-i-interface" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Find out the service interface class being used by this instance. If
<code>nil</code>, the interface is remote - it isn&#39;t part of the
middleware instance that owns the endpoint instance. The endpoint may not
be available, but you won&#39;t know until you try to talk to it over the
network.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-interface_source')" id="l_method-i-interface_source">show</a>
                
              </p>
              <div id="method-i-interface_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">interface</span>
  <span class="ruby-ivar">@local_service</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@local_service</span>[ <span class="ruby-value">:interface</span> ]
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-list">
            
              <b>list</b>( query_hash = nil )
            
            <a href="../../../classes/ApiTools/ServiceMiddleware/ServiceEndpoint.html#method-i-list" name="method-i-list" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Obtain a list of resource instance representations.</p>
<dl class="rdoc-list note-list"><dt>query_hash
<dd>
<p>See initialize. This is the only way to search/filter the list, according
to the targer Resource&#39;s documented supported search/filter parameters
and the platform&#39;s common all-resource behaviour.</p>
</dd></dl>

<p>Returns an array of zero or more resource representations as Hashes, unless
there&#39;s an error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-list_source')" id="l_method-i-list_source">show</a>
                
              </p>
              <div id="method-i-list_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">list</span>( <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;GET&#39;</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-show">
            
              <b>show</b>( ident, query_hash = nil )
            
            <a href="../../../classes/ApiTools/ServiceMiddleware/ServiceEndpoint.html#method-i-show" name="method-i-show" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Obtain a resource instance representation.</p>
<dl class="rdoc-list note-list"><dt>ident
<dd>
<p>See intiialize.</p>
</dd><dt>query_hash
<dd>
<p>See initialize.</p>
</dd></dl>

<p>Returns a Hash representation of a resource instance, unless there&#39;s an
error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-show_source')" id="l_method-i-show_source">show</a>
                
              </p>
              <div id="method-i-show_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 131</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">show</span>( <span class="ruby-identifier">ident</span>, <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;GET&#39;</span>,
    <span class="ruby-value">:ident</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ident</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-update">
            
              <b>update</b>( ident, body_hash, query_hash = nil )
            
            <a href="../../../classes/ApiTools/ServiceMiddleware/ServiceEndpoint.html#method-i-update" name="method-i-update" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Update a resource instance.</p>
<dl class="rdoc-list note-list"><dt>ident
<dd>
<p>See intiialize.</p>
</dd><dt>body_hash
<dd>
<p>See intiialize.</p>
</dd><dt><code>query_hash</code>
<dd>
<p>See initialize.</p>
</dd></dl>

<p>Returns a Hash representation of the updated resource instance, unless
there&#39;s an error (check the <a
href="../ServiceContext.html">ApiTools::ServiceContext</a> instance&#39;s
request object&#39;s <a
href="../ServiceResponse.html#method-i-halt_processing-3F">ApiTools::ServiceResponse#halt_processing?</a>
value).</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-update_source')" id="l_method-i-update_source">show</a>
                
              </p>
              <div id="method-i-update_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/api_tools/service_middleware/service_endpoint.rb, line 176</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">update</span>( <span class="ruby-identifier">ident</span>, <span class="ruby-identifier">body_hash</span>, <span class="ruby-identifier">query_hash</span> = <span class="ruby-keyword">nil</span> )
  <span class="ruby-ivar">@middleware</span>.<span class="ruby-identifier">inter_service</span>(
    <span class="ruby-value">:local</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@local_service</span>,
    <span class="ruby-value">:remote</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@remote_uri</span>,
    <span class="ruby-value">:resource</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@resource</span>,
    <span class="ruby-value">:version</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@version</span>,

    <span class="ruby-value">:http_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;PATCH&#39;</span>,
    <span class="ruby-value">:ident</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ident</span>,
    <span class="ruby-value">:body_hash</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">body_hash</span>,
    <span class="ruby-value">:query_hash</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">query_hash</span>
  )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    