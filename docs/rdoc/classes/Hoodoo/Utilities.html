<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Hoodoo::Utilities</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Module</span> 
            Hoodoo::Utilities 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/hoodoo/utilities/utilities_rb.html">lib/hoodoo/utilities/utilities.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Useful tools, especially for those working without Rails components.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-deep_merge_into">deep_merge_into</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-spare_port">spare_port</a>,
              </li>
            
              
              <li>
                <a href="#method-c-stringify">stringify</a>,
              </li>
            
              
              <li>
                <a href="#method-c-symbolize">symbolize</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-to_integer-3F">to_integer?</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-deep_merge_into">
            
              <b>deep_merge_into</b>( target_hash, inbound_hash )
            
            <a href="../../classes/Hoodoo/Utilities.html#method-c-deep_merge_into" name="method-c-deep_merge_into" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Deep merge two hashes.</p>

<p>Hash#merge/merge! only do a shallow merge. For example, without a block,
when starting with this hash:</p>

<pre><code>{ :one =&gt; { :two =&gt; { :three =&gt; 3 } } }
</code></pre>

<p>…and merging in this hash:</p>

<pre><code>{ :one =&gt; { :two =&gt; { :and_four =&gt; 4 } } }
</code></pre>

<p>…the possibly unexpected result is this:</p>

<pre><code>{ :one =&gt; { :two =&gt; { :and_four =&gt; 4 } } }
</code></pre>

<p>Because the value for key “:one” in the original hash is simply overwritten
with the value from the merged-in hash.</p>

<p>Deep merging takes a target hash, into which an “inbound” source hash is
merged and returns a new hash that is the deep merged result. Taking the
above example:</p>

<pre><code>target_hash  = { :one =&gt; { :two =&gt; { :three =&gt; 3 } } }
inbound_hash = { :one =&gt; { :two =&gt; { :and_four =&gt; 4 } } }
Hoodoo::Utilities.deep_merge_into( target_hash, inbound_hash )
</code></pre>

<p>…yields:</p>

<pre><code>{ :one =&gt; { :two =&gt; { :three =&gt; 3, :and_four =&gt; 4 } } }
</code></pre>

<p>For any same-named key with a non-hash value, the value in the inbound hash
will overwrite the value in the target hash.</p>

<p>Parameters:</p>
<dl class="rdoc-list note-list"><dt><code>target_hash</code>
<dd>
<p>The hash into which something will be merged.</p>
</dd><dt><code>inbound_hash</code>
<dd>
<p>The hash that will be merged into the target.</p>
</dd></dl>

<p>Returns the merged result.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-deep_merge_into_source')" id="l_method-c-deep_merge_into_source">show</a>
                
              </p>
              <div id="method-c-deep_merge_into_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/utilities/utilities.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">deep_merge_into</span>( <span class="ruby-identifier">target_hash</span>, <span class="ruby-identifier">inbound_hash</span> )

  <span class="ruby-comment"># Based on:</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># http://stackoverflow.com/questions/9381553/ruby-merge-nested-hash</span>

  <span class="ruby-identifier">merger</span> = <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">v1</span>, <span class="ruby-identifier">v2</span> <span class="ruby-operator">|</span>
    <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v2</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">v1</span>.<span class="ruby-identifier">merge</span>( <span class="ruby-identifier">v2</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">merger</span> ) <span class="ruby-operator">:</span> <span class="ruby-identifier">v2</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">v1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">v2</span>
  }

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">target_hash</span>.<span class="ruby-identifier">merge</span>( <span class="ruby-identifier">inbound_hash</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">merger</span> )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-spare_port">
            
              <b>spare_port</b>()
            
            <a href="../../classes/Hoodoo/Utilities.html#method-c-spare_port" name="method-c-spare_port" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Return a spare TCP port on localhost. This is free at the instant of
calling, though of course if you have anything in other local machine
processes/threads running which might start using ports at any moment,
there&#39;s a chance of the free port getting claimed in between you asking
for it and it being returned. This utility method is usually therefore used
for test environments only.</p>

<p><a
href="http://stackoverflow.com/questions/5985822/how-do-you-find-a-random-open-port-in-ruby">stackoverflow.com/questions/5985822/how-do-you-find-a-random-open-port-in-ruby</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-spare_port_source')" id="l_method-c-spare_port_source">show</a>
                
              </p>
              <div id="method-c-spare_port_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/utilities/utilities.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">spare_port</span>
  <span class="ruby-identifier">socket</span> = <span class="ruby-constant">Socket</span>.<span class="ruby-identifier">new</span>( <span class="ruby-value">:INET</span>, <span class="ruby-value">:STREAM</span>, <span class="ruby-number">0</span> )
  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">bind</span>( <span class="ruby-constant">Addrinfo</span>.<span class="ruby-identifier">tcp</span>( <span class="ruby-string">&#39;127.0.0.1&#39;</span>, <span class="ruby-number">0</span> ) )
  <span class="ruby-identifier">port</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">local_address</span>.<span class="ruby-identifier">ip_port</span>
  <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">port</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-stringify">
            
              <b>stringify</b>(obj)
            
            <a href="../../classes/Hoodoo/Utilities.html#method-c-stringify" name="method-c-stringify" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>The keys-to-strings equivalent of <a
href="Utilities.html#method-c-symbolize">::symbolize</a>.</p>
<dl class="rdoc-list note-list"><dt>obj
<dd>
<p>Hash or Array of Hashes. Will recursively convert keys in Hashes to
strings. Hashes with values that are Arrays of Hashes will be dealt with
properly. Does not modify other types (e.g. an Array of Symbols would stay
an Array of Symbols).</p>
</dd></dl>

<p>Returns a copy of your input object with keys converted to strings.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-stringify_source')" id="l_method-c-stringify_source">show</a>
                
              </p>
              <div id="method-c-stringify_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/utilities/utilities.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">stringify</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">memo</span>,(<span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span>)<span class="ruby-operator">|</span> <span class="ruby-identifier">memo</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>] =  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stringify</span>(<span class="ruby-identifier">v</span>); <span class="ruby-identifier">memo</span>} <span class="ruby-keyword">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Hash</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">inject</span>([]){<span class="ruby-operator">|</span><span class="ruby-identifier">memo</span>,<span class="ruby-identifier">v</span>    <span class="ruby-operator">|</span> <span class="ruby-identifier">memo</span>         <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stringify</span>(<span class="ruby-identifier">v</span>); <span class="ruby-identifier">memo</span>} <span class="ruby-keyword">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Array</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-symbolize">
            
              <b>symbolize</b>(obj)
            
            <a href="../../classes/Hoodoo/Utilities.html#method-c-symbolize" name="method-c-symbolize" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Given a hash, returns the same hash with keys converted to symbols. Works
with nested hashes. Taken from:</p>

<p><a
href="http://stackoverflow.com/questions/800122/best-way-to-convert-strings-to-symbols-in-hash">stackoverflow.com/questions/800122/best-way-to-convert-strings-to-symbols-in-hash</a></p>

<p><strong>WARNING!</strong> In Ruby, Symbols are not garbage collected and
will stay in RAM forever. <strong>DO</strong> <strong>NOT</strong>
symbolize hashes containing data provided by an API caller (or any
generalised external data) unless you&#39;ve already made sure that the
things you are turning into Symbols are white listed. Otherwise, a
malicious (or accidentally misbehaving) caller could cause your code to
symbolize a Hash with lots of different strings, filling up memory. Related
to:</p>

<p><a
href="https://www.ruby-lang.org/en/news/2013/02/22/json-dos-cve-2013-0269">www.ruby-lang.org/en/news/2013/02/22/json-dos-cve-2013-0269</a>/</p>
<dl class="rdoc-list note-list"><dt><code>obj</code>
<dd>
<p>Hash or Array of Hashes. Will recursively convert keys in Hashes to
symbols. Hashes with values that are Arrays of Hashes will be dealt with
properly. Does not modify other types (e.g. an Array of Strings would stay
an Array of Strings).</p>
</dd></dl>

<p>Returns a copy of your input object with keys converted to symbols.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-symbolize_source')" id="l_method-c-symbolize_source">show</a>
                
              </p>
              <div id="method-c-symbolize_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/utilities/utilities.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">symbolize</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">memo</span>,(<span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span>)<span class="ruby-operator">|</span> <span class="ruby-identifier">memo</span>[<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">to_sym</span>] =  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">symbolize</span>(<span class="ruby-identifier">v</span>); <span class="ruby-identifier">memo</span>} <span class="ruby-keyword">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Hash</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">inject</span>([]){<span class="ruby-operator">|</span><span class="ruby-identifier">memo</span>,<span class="ruby-identifier">v</span>    <span class="ruby-operator">|</span> <span class="ruby-identifier">memo</span>                <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">symbolize</span>(<span class="ruby-identifier">v</span>); <span class="ruby-identifier">memo</span>} <span class="ruby-keyword">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Array</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">obj</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-to_integer-3F">
            
              <b>to_integer?</b>( value )
            
            <a href="../../classes/Hoodoo/Utilities.html#method-c-to_integer-3F" name="method-c-to_integer-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Is a parameter convertable to an integer cleanly? Returns the integer value
if so, else <code>nil</code>.</p>
<dl class="rdoc-list note-list"><dt>value
<dd>
<p>Value to check, e.g. 2, “44”, :&#39;55&#39; (yields 2, 44, 55) or “hello”,
Time.now (yields nil, nil).</p>
</dd></dl>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-to_integer-3F_source')" id="l_method-c-to_integer-3F_source">show</a>
                
              </p>
              <div id="method-c-to_integer-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/utilities/utilities.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">to_integer?</span>( <span class="ruby-identifier">value</span> )
  <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                        </div>

    </div>
  </body>
</html>    