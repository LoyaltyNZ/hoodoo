<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Hoodoo::Services::Session</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            Hoodoo::Services::Session 
            
                <span class="parent">&lt; 
                    
                    Object
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/lib/hoodoo/services/services/session_rb.html">lib/hoodoo/services/services/session.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>A container for functionality related to a context session.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-from_h">from_h</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-identity-3D">identity=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-load_from_memcached-21">load_from_memcached!</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-save_to_memcached">save_to_memcached</a>,
              </li>
            
              
              <li>
                <a href="#method-i-scoping-3D">scoping=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-to_h">to_h</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">TTL</td>
            <td>=</td>
            <td class="attr-value">172800</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Time To Live: Number of seconds for which a session remains valid after
being saved. Only applicable from the save time onwards in stores that
support <a href="Session.html#TTL">TTL</a> such as Memcached - see <a
href="Session.html#method-i-save_to_memcached">save_to_memcached</a>.</p></td>
            </tr>
          
        
      </table>
    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>expires_at</td>
            <td class='attr-desc'><p>The expiry date for this session - the session should be considered expired
at or after this date. Some session stores may support automatic expiry of
session data, but there may be a small window between the expiry date
passing and the store expiring the data; so always check the expiry.</p>

<p>Only set when the session is saved (or loaded from a representation that
includes an existing expiry date). See e.g.:</p>
<ul><li>
<p><a href="Session.html#method-i-save_to_memcached">save_to_memcached</a></p>
</li></ul>

<p>The value is a Time instance in UTC. If <code>nil</code>, the session has
not yet been saved.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>identity</td>
            <td class='attr-desc'><p>An OpenStruct instance with session-creator defined key/value pairs that
define the <em>identity</em> of the session holder. This is usually related
to a Caller resource instance - see also <a
href="../Data/Resources/Caller.html">Hoodoo::Data::Resources::Caller</a> -
and will often contain a Caller resource instance&#39;s <a
href="../UUID.html">UUID</a>, amongst other data.</p>

<p>The object describes “who the session&#39;s owner is”.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>memcached_url</td>
            <td class='attr-desc'><p>Connection URL for Memcached.</p>

<p>If you are using Memcached for a session store, you can set the Memcached
connection URL either through this accessor, or via the object&#39;s
constructor.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>permissions</td>
            <td class='attr-desc'><p>A <a href="Permissions.html">Hoodoo::Services::Permissions</a> instance.</p>

<p>The instance describes “what the session session is allowed to do”.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>scoping</td>
            <td class='attr-desc'><p>An OpenStruct instance with session-creator defined values that describe
the <em>scoping</em>, that is, visbility of data, for the session. Its
contents relate to service resource interface descriptions (see the DSL for
<a href="Interface.html">Hoodoo::Services::Interface</a>) and may be
partially or entirely supported by the <a
href="../ActiveRecord.html">ActiveRecord</a> finder extensions in <a
href="../ActiveRecord/Finder.html">Hoodoo::ActiveRecord::Finder</a>.</p>

<p>The object describes the “data that the session can &#39;see&#39;”.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_id</td>
            <td class='attr-desc'><p>A <a href="Session.html">Session</a> must have its own <a
href="../UUID.html">UUID</a>. This is that ID.</p></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>new</b>( options = {} )
            
            <a href="../../../classes/Hoodoo/Services/Session.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Create a new instance.</p>
<dl class="rdoc-list note-list"><dt>options
<dd>
<p>Optional Hash of options, described below.</p>
</dd></dl>

<p>Options are:</p>
<dl class="rdoc-list note-list"><dt><code>session_id</code>
<dd>
<p><a href="../UUID.html">UUID</a> of this session. If unset, a new <a
href="../UUID.html">UUID</a> is generated for you. You can read the <a
href="../UUID.html">UUID</a> with the <a
href="Session.html#attribute-i-session_id">session_id</a> accessor method.</p>
</dd><dt><code>memcached_url</code>
<dd>
<p>URL for Memcached connections; required if you want to use the <a
href="Session.html#method-i-load_from_memcached-21">load_from_memcached!</a>
or <a href="Session.html#method-i-save_to_memcached">save_to_memcached</a>
methods.</p>
</dd></dl>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/services/services/session.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">initialize</span>( <span class="ruby-identifier">options</span> = {} )
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">session_id</span>    = <span class="ruby-identifier">options</span>[ <span class="ruby-value">:session_id</span>    ] <span class="ruby-operator">||</span> <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">UUID</span>.<span class="ruby-identifier">generate</span>()
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">memcached_url</span> = <span class="ruby-identifier">options</span>[ <span class="ruby-value">:memcached_url</span> ]
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-from_h">
            
              <b>from_h</b>( hash )
            
            <a href="../../../classes/Hoodoo/Services/Session.html#method-i-from_h" name="method-i-from_h" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Load session parameters from a given Hash, of the form set by <a
href="Session.html#method-i-to_h">to_h</a>.</p>

<p>If appropriate Hash keys are present, will set any or all of <a
href="Session.html#attribute-i-session_id">session_id</a>, <a
href="Session.html#attribute-i-identity">identity</a>, <a
href="Session.html#attribute-i-scoping">scoping</a> and <a
href="Session.html#attribute-i-permissions">permissions</a>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-from_h_source')" id="l_method-i-from_h_source">show</a>
                
              </p>
              <div id="method-i-from_h_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/services/services/session.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">from_h</span>( <span class="ruby-identifier">hash</span> )
  <span class="ruby-identifier">hash</span> = <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Utilities</span>.<span class="ruby-identifier">stringify</span>( <span class="ruby-identifier">hash</span> )

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">session_id</span> = <span class="ruby-identifier">hash</span>[ <span class="ruby-string">&#39;session_id&#39;</span> ] <span class="ruby-keyword">if</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-string">&#39;session_id&#39;</span> )
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">identity</span>   = <span class="ruby-identifier">hash</span>[ <span class="ruby-string">&#39;identity&#39;</span>   ] <span class="ruby-keyword">if</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-string">&#39;identity&#39;</span>   )
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">scoping</span>    = <span class="ruby-identifier">hash</span>[ <span class="ruby-string">&#39;scoping&#39;</span>    ] <span class="ruby-keyword">if</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-string">&#39;scoping&#39;</span>    )

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-string">&#39;permissions&#39;</span> )
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">permissions</span> = <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Permissions</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">hash</span>[ <span class="ruby-string">&#39;permissions&#39;</span> ] )
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">has_key?</span>( <span class="ruby-string">&#39;expires_at&#39;</span> )
    <span class="ruby-keyword">begin</span>
      <span class="ruby-ivar">@expires_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">hash</span>[ <span class="ruby-string">&#39;expires_at&#39;</span> ] ).<span class="ruby-identifier">utc</span>()
    <span class="ruby-keyword">rescue</span>
      <span class="ruby-ivar">@expires_at</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-identity-3D">
            
              <b>identity=</b>( hash )
            
            <a href="../../../classes/Hoodoo/Services/Session.html#method-i-identity-3D" name="method-i-identity-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Set the identity data via a Hash of key/value pairs - see also <a
href="Session.html#attribute-i-identity">identity</a>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-identity-3D_source')" id="l_method-i-identity-3D_source">show</a>
                
              </p>
              <div id="method-i-identity-3D_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/services/services/session.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">identity=</span>( <span class="ruby-identifier">hash</span> )
  <span class="ruby-ivar">@identity</span> = <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">hash</span> )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-load_from_memcached-21">
            
              <b>load_from_memcached!</b>( session_id )
            
            <a href="../../../classes/Hoodoo/Services/Session.html#method-i-load_from_memcached-21" name="method-i-load_from_memcached-21" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Load session data into this instance, overwriting instance values if the
session is found. Raises an exception if there is a problem connecting to
Memcached. A Memcached connection URL must have been set through the
constructor or <a
href="Session.html#attribute-i-memcached_url">memcached_url</a> accessor
first.</p>

<p>Returns &#39;this instance&#39; for convenience on success, or
<code>nil</code> if the session cannot be loaded from Memcached (session
not found).</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-load_from_memcached-21_source')" id="l_method-i-load_from_memcached-21_source">show</a>
                
              </p>
              <div id="method-i-load_from_memcached-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/services/services/session.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">load_from_memcached!</span>( <span class="ruby-identifier">session_id</span> )
  <span class="ruby-identifier">client</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">connect_to_memcached</span>( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">memcached_url</span>() )

  <span class="ruby-keyword">begin</span>

    <span class="ruby-identifier">session_hash</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">get</span>( <span class="ruby-identifier">session_id</span> )

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">session_hash</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">from_h</span>( <span class="ruby-identifier">session_hash</span> )
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exception</span>

    <span class="ruby-comment"># Log error and return nil if the session can&#39;t be parsed</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleware</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(
      <span class="ruby-string">&#39;Hoodoo::Services::Session\#load_from_memcached!: Session loading failed - connection fault or session corrupt&#39;</span>,
      <span class="ruby-identifier">exception</span>
    )

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-save_to_memcached">
            
              <b>save_to_memcached</b>()
            
            <a href="../../../classes/Hoodoo/Services/Session.html#method-i-save_to_memcached" name="method-i-save_to_memcached" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Save this session to Memcached, in a manner that will allow it to be loaded
by <a
href="Session.html#method-i-load_from_memcached-21">load_from_memcached!</a>
later.</p>

<p>The Hoodoo::Services::Session::TTL constant determines how long the key
lives in Memcached.</p>

<p>If successful, returns the now-set/now-updated value of <a
href="Session.html#attribute-i-expires_at">expires_at</a>.</p>

<p>If unsuccessful, the method raises an exception or returns
<code>nil</code>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-save_to_memcached_source')" id="l_method-i-save_to_memcached_source">show</a>
                
              </p>
              <div id="method-i-save_to_memcached_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/services/services/session.rb, line 125</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">save_to_memcached</span>
  <span class="ruby-identifier">client</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">connect_to_memcached</span>( <span class="ruby-keyword">self</span>.<span class="ruby-identifier">memcached_url</span>() )

  <span class="ruby-keyword">begin</span>

    <span class="ruby-comment"># Must set this before saving, even though the delay between</span>
    <span class="ruby-comment"># setting this value and Memcached actually saving the value</span>
    <span class="ruby-comment"># with a TTL will mean that Memcached expires the key slightly</span>
    <span class="ruby-comment"># *after* the time we record.</span>

    <span class="ruby-ivar">@expires_at</span> = ( <span class="ruby-operator">::</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">+</span> <span class="ruby-constant">TTL</span> ).<span class="ruby-identifier">utc</span>()

    <span class="ruby-identifier">success</span> = <span class="ruby-identifier">memcache</span>.<span class="ruby-identifier">set</span>( <span class="ruby-identifier">session_id</span>,
                            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">to_h</span>(),
                            <span class="ruby-constant">Hooodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">TTL</span> )

    <span class="ruby-keyword">if</span> ( <span class="ruby-operator">!</span> <span class="ruby-identifier">success</span> )
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-ivar">@expires_at</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exception</span>

    <span class="ruby-comment"># Log error and return nil if the session can&#39;t be parsed</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-constant">Hoodoo</span><span class="ruby-operator">::</span><span class="ruby-constant">Services</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleware</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(
      <span class="ruby-string">&#39;Hoodoo::Services::Session\#save_to_memcached: Session saving failed - connection fault or session corrupt&#39;</span>,
      <span class="ruby-identifier">exception</span>
    )

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-scoping-3D">
            
              <b>scoping=</b>( hash )
            
            <a href="../../../classes/Hoodoo/Services/Session.html#method-i-scoping-3D" name="method-i-scoping-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Set the scoping data via a Hash of key/value pairs - see also <a
href="Session.html#attribute-i-scoping">scoping</a>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-scoping-3D_source')" id="l_method-i-scoping-3D_source">show</a>
                
              </p>
              <div id="method-i-scoping-3D_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/services/services/session.rb, line 68</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">scoping=</span>( <span class="ruby-identifier">hash</span> )
  <span class="ruby-ivar">@scoping</span> = <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">hash</span> )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-to_h">
            
              <b>to_h</b>()
            
            <a href="../../../classes/Hoodoo/Services/Session.html#method-i-to_h" name="method-i-to_h" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Represent this session&#39;s data as a Hash, for uses such as storage in
Memcached or loading into another session instance. See also <a
href="Session.html#method-i-from_h">from_h</a>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-to_h_source')" id="l_method-i-to_h_source">show</a>
                
              </p>
              <div id="method-i-to_h_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/hoodoo/services/services/session.rb, line 199</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">to_h</span>
  {
    <span class="ruby-string">&#39;session_id&#39;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">session_id</span>,
    <span class="ruby-string">&#39;identity&#39;</span>    =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">identity</span>.<span class="ruby-identifier">to_h</span>(),
    <span class="ruby-string">&#39;scoping&#39;</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">scoping</span>.<span class="ruby-identifier">to_h</span>(),
    <span class="ruby-string">&#39;permissions&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">permissions</span>.<span class="ruby-identifier">to_h</span>(),
    <span class="ruby-string">&#39;exipres_at&#39;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">expires_at</span>.<span class="ruby-identifier">iso8601</span>
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    